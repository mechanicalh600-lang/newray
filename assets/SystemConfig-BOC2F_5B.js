import{c as P,u as W,r as o,s as m,j as e,bN as B,I as F,aw as H,aM as G,am as K,bO as Y,ae as N,ar as J,bP as $,Y as V,V as X,F as Q,b2 as Z}from"./index-Ba5jVD6p.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=P("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=P("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),E=(()=>{const f=[];return Z.forEach(d=>{d.submenu?d.submenu.forEach(p=>{p.path&&p.path!=="#"&&f.push({path:p.path,title:p.title})}):d.path&&d.path!=="#"&&f.push({path:d.path,title:d.title})}),f.sort((d,p)=>d.title.localeCompare(p.title))})(),se=()=>{W();const[f,d]=o.useState(!1),[p,v]=o.useState(!1),[C,y]=o.useState([]),[h,T]=o.useState(!1),[r,c]=o.useState({id:"",org_name:"",org_logo:"",session_timeout_minutes:5,maintenance_mode:!1,announcement_message:"",announcement_active:!1,max_upload_size_mb:5,shift_a_start:"07:00",shift_b_start:"15:00",shift_c_start:"23:00",work_order_prefix:"WO",pm_plan_prefix:"PM",request_part_prefix:"PR",purchase_request_prefix:"PUR",meeting_prefix:"MT",suggestion_prefix:"SUG",incident_prefix:"HSE",lab_report_prefix:"LAB",warehouse_entry_prefix:"W-IN",warehouse_exit_prefix:"W-OUT",scale_report_prefix:"SCL",document_prefix:"DOC",project_prefix:"PROJ",training_course_prefix:"TRN",ptw_prefix:"PTW"}),j=o.useRef(null),[w,S]=o.useState([]),[L,_]=o.useState(!1),[l,u]=o.useState(null),[x,b]=o.useState({prefix_value:"",label:"",linked_to:""});o.useEffect(()=>{M()},[]),o.useEffect(()=>{k()},[]);const k=async()=>{try{const{data:t,error:s}=await m.from("coding_formats").select("id, prefix_value, label, linked_to, sort_order").order("sort_order");if(s)throw s;S(t||[])}catch{S([])}},q=async t=>{t.preventDefault();try{if(l){const{error:s}=await m.from("coding_formats").update({prefix_value:l.prefix_value.trim().toUpperCase(),label:l.label.trim(),linked_to:l.linked_to||null}).eq("id",l.id);if(s)throw s;u(null)}else{if(!x.label.trim()||!x.prefix_value.trim())return alert("عنوان و پیشوند الزامی است");const{error:s}=await m.from("coding_formats").insert({prefix_value:x.prefix_value.trim().toUpperCase(),label:x.label.trim(),linked_to:x.linked_to||null});if(s)throw s;b({prefix_value:"",label:"",linked_to:""}),_(!1)}await k()}catch(s){alert("خطا: "+((s==null?void 0:s.message)||s))}},A=async t=>{if(!confirm("آیا این فرمت حذف شود؟"))return;const{error:s}=await m.from("coding_formats").delete().eq("id",t);if(s)throw s;await k()};o.useEffect(()=>{if(!h||!r.id)return;(async()=>{try{const{data:s}=await m.from("announcement_acknowledgments").select("user_id, acknowledged_at").eq("app_settings_id",r.id).order("acknowledged_at",{ascending:!1});if(!(s!=null&&s.length)){y([]);return}const{data:a}=await m.from("app_users").select("id, username, personnel(full_name)").in("id",s.map(i=>i.user_id)),n=new Map((a||[]).map(i=>{var g;return[i.id,((g=i.personnel)==null?void 0:g.full_name)||i.username||"-"]}));y(s.map(i=>{if(!i.acknowledged_at)return{user_name:n.get(i.user_id)||"-",acknowledged_at:"-"};const g=new Date(i.acknowledged_at),D=g.toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),z=g.toLocaleDateString("fa-IR");return{user_name:n.get(i.user_id)||"-",acknowledged_at:`${D} | ${z}`}}))}catch{y([])}})()},[h,r.id]);const M=async()=>{d(!0);try{const{data:t,error:s}=await m.from("app_settings").select("*").order("created_at",{ascending:!0}).limit(1);if(s)throw s;const a=Array.isArray(t)?t[0]:null;a&&c({id:a.id,org_name:a.org_name||"",org_logo:a.org_logo||"",session_timeout_minutes:a.session_timeout_minutes||5,maintenance_mode:a.maintenance_mode||!1,announcement_message:a.announcement_message||"",announcement_active:a.announcement_active||!1,max_upload_size_mb:a.max_upload_size_mb||5,shift_a_start:a.shift_a_start||"07:00",shift_b_start:a.shift_b_start||"15:00",shift_c_start:a.shift_c_start||"23:00",work_order_prefix:a.work_order_prefix||"WO",pm_plan_prefix:a.pm_plan_prefix||"PM",request_part_prefix:a.request_part_prefix||"PR",purchase_request_prefix:a.purchase_request_prefix||"PUR",meeting_prefix:a.meeting_prefix||"MT",suggestion_prefix:a.suggestion_prefix||"SUG",incident_prefix:a.incident_prefix||"HSE",lab_report_prefix:a.lab_report_prefix||"LAB",warehouse_entry_prefix:a.warehouse_entry_prefix||"W-IN",warehouse_exit_prefix:a.warehouse_exit_prefix||"W-OUT",scale_report_prefix:a.scale_report_prefix||"SCL",document_prefix:a.document_prefix||"DOC",project_prefix:a.project_prefix||"PROJ",training_course_prefix:a.training_course_prefix||"TRN",ptw_prefix:a.ptw_prefix||"PTW"})}catch(t){console.error("Error fetching settings:",t)}finally{d(!1)}},R={"/work-orders":"work_order_prefix","/pm-scheduler":"pm_plan_prefix","/part-requests":"request_part_prefix","/purchases":"purchase_request_prefix","/meetings":"meeting_prefix","/suggestions":"suggestion_prefix","/hse-report":"incident_prefix","/lab-report":"lab_report_prefix","/scale-report":"scale_report_prefix","/documents":"document_prefix","/projects":"project_prefix","/training-courses":"training_course_prefix","/permits":"ptw_prefix"},I={"W-IN":"warehouse_entry_prefix","W-OUT":"warehouse_exit_prefix"},O=async t=>{t.preventDefault(),v(!0);try{const s={...r};if(w.forEach(a=>{const n=I[a.prefix_value]||(a.linked_to?R[a.linked_to]:null);n&&s[n]!==void 0&&(s[n]=a.prefix_value)}),s.id){const{error:a}=await m.from("app_settings").update(s).eq("id",s.id);if(a)throw a}else{const{data:a,error:n}=await m.from("app_settings").insert([s]).select("id").single();if(n)throw n;a!=null&&a.id&&c(i=>({...i,id:a.id}))}alert("تنظیمات با موفقیت ذخیره شد."),await M()}catch(s){alert("خطا در ذخیره تنظیمات: "+s.message)}finally{v(!1)}},U=t=>{var a;const s=(a=t.target.files)==null?void 0:a[0];if(s){if(s.size>500*1024){alert("حجم فایل لوگو نباید بیشتر از 500 کیلوبایت باشد.");return}const n=new FileReader;n.onloadend=()=>{c(i=>({...i,org_logo:n.result}))},n.readAsDataURL(s)}};return e.jsxs("div",{className:"max-w-6xl mx-auto pb-20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-lg shadow-sm",children:e.jsx(B,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"تنظیمات نرم‌افزار"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"مدیریت پارامترهای عمومی و سیستمی"})]})]}),e.jsxs("form",{onSubmit:O,className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 text-center",children:[e.jsxs("h3",{className:"font-bold text-gray-700 dark:text-gray-200 mb-4 flex items-center justify-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5 text-primary"})," هویت سازمان"]}),e.jsxs("div",{className:"relative w-32 h-32 mx-auto mb-4 bg-gray-100 dark:bg-gray-700 rounded-full border-4 border-white dark:border-gray-600 shadow-md flex items-center justify-center overflow-hidden group",children:[r.org_logo?e.jsx("img",{src:r.org_logo,alt:"Logo",className:"w-full h-full object-contain p-2"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"بدون لوگو"}),e.jsx("div",{onClick:()=>{var t;return(t=j.current)==null?void 0:t.click()},className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition cursor-pointer",children:e.jsx(F,{className:"w-8 h-8 text-white"})})]}),e.jsx("input",{type:"file",ref:j,className:"hidden",accept:"image/*",onChange:U}),e.jsx("button",{type:"button",onClick:()=>{var t;return(t=j.current)==null?void 0:t.click()},className:"text-sm text-blue-600 hover:underline",children:"تغییر لوگو"}),e.jsxs("div",{className:"mt-4 text-right",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"نام سازمان"}),e.jsx("input",{type:"text",value:r.org_name,onChange:t=>c({...r,org_name:t.target.value}),className:"w-full p-2 text-center border rounded-lg bg-gray-50 dark:bg-gray-900 dark:border-gray-600",placeholder:"نام شرکت..."})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold text-gray-700 dark:text-gray-200 mb-4 border-b pb-2 flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5 text-yellow-500"})," اعلان سراسری"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"نمایش اعلان"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:r.announcement_active,onChange:t=>c({...r,announcement_active:t.target.checked})}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-500"})]})]}),e.jsx("textarea",{className:"w-full p-3 border rounded-lg bg-yellow-50 dark:bg-yellow-900/10 dark:border-yellow-900 text-sm outline-none resize-none",rows:3,placeholder:"متن پیام برای تمام کاربران...",value:r.announcement_message,onChange:t=>c({...r,announcement_message:t.target.value})}),r.id&&e.jsxs("div",{className:"pt-3 border-t border-yellow-200 dark:border-yellow-800 mt-3",children:[e.jsxs("button",{type:"button",onClick:()=>T(!h),className:"flex items-center gap-2 text-sm text-yellow-700 dark:text-yellow-400 hover:underline",children:[h?e.jsx(G,{className:"w-4 h-4"}):e.jsx(K,{className:"w-4 h-4"}),h?"مخفی کردن لیست":"لیست کسانی که متوجه شدم زده‌اند"]}),h&&e.jsx("div",{className:"mt-2 max-h-40 overflow-y-auto rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-yellow-100 dark:bg-yellow-900/30 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-right",children:"کاربر"}),e.jsx("th",{className:"p-2 text-right",children:"زمان"})]})}),e.jsx("tbody",{children:C.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"p-3 text-gray-500 text-center",children:"هنوز هیچ‌کس متوجه شدم نزده است"})}):C.map((t,s)=>e.jsxs("tr",{className:"border-t border-yellow-100 dark:border-yellow-900/20",children:[e.jsx("td",{className:"p-2",children:t.user_name}),e.jsx("td",{className:"p-2 text-gray-500",children:t.acknowledged_at})]},s))})]})})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold text-gray-700 dark:text-gray-200 mb-4 border-b pb-2 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-purple-500"})," پارامترهای عملیاتی"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-gray-500 mb-2",children:"زمان‌بندی شیفت‌ها"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs",children:"شیفت A"})," ",e.jsx(N,{value:r.shift_a_start,onChange:t=>c({...r,shift_a_start:t})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs",children:"شیفت B"})," ",e.jsx(N,{value:r.shift_b_start,onChange:t=>c({...r,shift_b_start:t})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs",children:"شیفت C"})," ",e.jsx(N,{value:r.shift_c_start,onChange:t=>c({...r,shift_c_start:t})})]})]})]}),e.jsx("div",{className:"pt-2 border-t dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm flex items-center gap-1",children:[e.jsx(te,{className:"w-3 h-3"})," حجم آپلود (MB)"]}),e.jsx("input",{type:"number",value:r.max_upload_size_mb,onChange:t=>c({...r,max_upload_size_mb:Number(t.target.value)}),className:"w-16 p-1 text-center border rounded bg-gray-50 dark:bg-gray-700 text-sm"})]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold text-gray-700 dark:text-gray-200 mb-4 border-b pb-2 flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-orange-500"})," نشست کاربری"]}),e.jsxs("div",{className:"flex items-center justify-between bg-orange-50 dark:bg-orange-900/10 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-gray-800 dark:text-gray-200 block text-sm",children:"خروج خودکار"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"عدم فعالیت کاربر"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",min:"1",max:"120",value:r.session_timeout_minutes,onChange:t=>c({...r,session_timeout_minutes:Number(t.target.value)}),className:"w-16 p-2 text-center border border-orange-200 rounded-lg font-bold outline-none focus:ring-2 focus:ring-orange-400"}),e.jsx("span",{className:"text-sm",children:"دقیقه"})]})]})]})]}),e.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col min-h-[300px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b pb-2 flex-shrink-0",children:[e.jsxs("h3",{className:"font-bold text-gray-700 dark:text-gray-200 flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-indigo-500"})," فرمت کدگذاری"]}),e.jsx("button",{type:"button",onClick:()=>_(!0),className:"p-1.5 bg-indigo-100 text-indigo-600 rounded-lg hover:bg-indigo-200 transition",title:"افزودن",children:e.jsx(V,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"space-y-2 flex-1 min-h-0 overflow-y-auto",children:w.length===0?e.jsx("p",{className:"text-xs text-gray-500 py-4 text-center",children:"جدول فرمت کدگذاری خالی است. مایگریشن را اجرا کنید یا افزودن را بزنید."}):w.map(t=>{var s;return e.jsxs("div",{className:"flex items-center justify-between gap-2 py-2 border-b dark:border-gray-700 last:border-0",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.label}),e.jsx("span",{className:"text-[10px] text-gray-500 block truncate",title:t.linked_to||"-",children:t.linked_to?((s=E.find(a=>a.path===t.linked_to))==null?void 0:s.title)||t.linked_to:"—"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-14 p-1 text-center border rounded bg-gray-50 dark:bg-gray-700 font-mono text-xs uppercase",children:t.prefix_value}),e.jsx("button",{type:"button",onClick:()=>u({id:t.id,prefix_value:t.prefix_value,label:t.label,linked_to:t.linked_to||""}),className:"p-1 text-gray-500 hover:text-indigo-600",children:"ویرایش"}),e.jsx("button",{type:"button",onClick:()=>A(t.id),className:"p-1 text-gray-500 hover:text-red-600",children:e.jsx(X,{className:"w-3.5 h-3.5"})})]})]},t.id)})}),(L||l)&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",onClick:()=>{_(!1),u(null)},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-sm w-full mx-4 p-6",onClick:t=>t.stopPropagation(),children:[e.jsx("h4",{className:"font-bold mb-4",children:l?"ویرایش فرمت":"افزودن فرمت کدگذاری"}),e.jsxs("form",{onSubmit:q,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"عنوان (فارسی)"}),e.jsx("input",{type:"text",value:(l==null?void 0:l.label)??x.label,onChange:t=>l?u({...l,label:t.target.value}):b({...x,label:t.target.value}),className:"w-full p-2 border rounded-lg dark:bg-gray-700",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"پیشوند کد"}),e.jsx("input",{type:"text",value:(l==null?void 0:l.prefix_value)??x.prefix_value,onChange:t=>l?u({...l,prefix_value:t.target.value}):b({...x,prefix_value:t.target.value}),className:"w-full p-2 border rounded-lg dark:bg-gray-700 font-mono uppercase",placeholder:"مثال: WO",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1",children:"اتصال به گزارش/منو"}),e.jsxs("select",{value:(l==null?void 0:l.linked_to)??x.linked_to,onChange:t=>l?u({...l,linked_to:t.target.value}):b({...x,linked_to:t.target.value}),className:"w-full p-2 border rounded-lg dark:bg-gray-700",children:[e.jsx("option",{value:"",children:"بدون اتصال"}),E.map(t=>e.jsx("option",{value:t.path,children:t.title},t.path))]})]}),e.jsxs("div",{className:"flex gap-2 justify-end pt-2",children:[e.jsx("button",{type:"button",onClick:()=>{_(!1),u(null)},className:"px-3 py-1.5 border rounded-lg",children:"انصراف"}),e.jsx("button",{type:"submit",className:"px-3 py-1.5 bg-indigo-600 text-white rounded-lg",children:"ذخیره"})]})]})]})})]}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs("button",{type:"submit",disabled:p,className:"w-full bg-primary text-white py-4 rounded-xl font-bold shadow-lg shadow-red-900/20 hover:bg-red-800 transition flex items-center justify-center gap-2 disabled:opacity-50",children:[p?"در حال ذخیره...":"ذخیره تنظیمات"," ",e.jsx(Q,{className:"w-5 h-5"})]})})]})]})};export{se as SystemConfig,se as default};
