import{u as ee,h as W,r as o,s as p,j as e,m as re,an as se,az as ae,k as V,t as te,X as z,ar as de,aC as le,C as F,bq as ne,W as ie,aq as oe,d as ce,o as xe,p as me,br as ge}from"./index-Ba5jVD6p.js";import{WorkOrders as he}from"./WorkOrders-DzOXS3Jr.js";import{S as pe}from"./ShiftHandoverReport-ctJHqSqd.js";import{C as be}from"./coffee-CK5ktbjd.js";import"./paperclip-CYuFmfPe.js";import"./share-2-DqqORqgq.js";import"./BarChart-CG56lHO5.js";import"./PieChart-D5hrt51y.js";import"./LineChart-BSiQnK8R.js";import"./refresh-ccw-7aaP1mjM.js";const qe=()=>{var M,O,E,A,T,L;ee();const v=W(),[u,y]=o.useState(parseInt(v.split("/")[0])),[m,f]=o.useState(parseInt(v.split("/")[1])),[c,P]=o.useState({}),[ue,k]=o.useState(!1),[i,w]=o.useState(null),[d,_]=o.useState(null),[t,g]=o.useState(null),[C,D]=o.useState(!1),R=["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],B=["شنبه","یکشنبه","دوشنبه","سه‌شنبه","چهارشنبه","پنج‌شنبه","جمعه"],H=Array.from({length:11},(r,s)=>1400+s);o.useEffect(()=>{Y()},[u,m]);const Y=async()=>{k(!0);const r=`${u}/${String(m).padStart(2,"0")}`,s={};try{const{data:l}=await p.from("personal_notes").select("id, title, reminder_date, is_completed").like("reminder_date",`${r}%`),{data:x}=await p.from("pm_plans").select("id, title, next_run_date, equipment(name)").like("next_run_date",`${r}%`),{data:b}=await p.from("work_orders").select("id, tracking_code, request_date, equipment_name, status, failure_description").like("request_date",`${r}%`),{data:n}=await p.from("shift_reports").select("id, tracking_code, shift_date, shift_name, total_production_a, total_production_b").like("shift_date",`${r}%`),h=(a,U,Z)=>{s[a]||(s[a]={notes:[],pms:[],workOrders:[],reports:[]}),s[a][U].push(Z)};l==null||l.forEach(a=>h(a.reminder_date,"notes",a)),x==null||x.forEach(a=>h(a.next_run_date,"pms",a)),b==null||b.forEach(a=>h(a.request_date,"workOrders",a)),n==null||n.forEach(a=>h(a.shift_date,"reports",a)),P(s)}catch(l){console.error("Error fetching calendar events:",l)}finally{k(!1)}},G=(r,s)=>s<=6?31:s<=11||r%33===1||r%33===5||r%33===9||r%33===13||r%33===17||r%33===22||r%33===26||r%33===30?30:29,X=(r,s)=>{const{gy:l,gm:x,gd:b}=ge(r,s,1);return(new Date(l,x-1,b).getDay()+1)%7},J=()=>{m===1?(f(12),y(r=>r-1)):f(r=>r-1)},K=()=>{m===12?(f(1),y(r=>r+1)):f(r=>r+1)},q=G(u,m),N=X(u,m),Q=Array.from({length:q},(r,s)=>s+1),S=r=>r.startsWith("DAY")?"bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-900/30 dark:text-amber-300 dark:border-amber-800":r.startsWith("NIGHT")?"bg-indigo-100 text-indigo-800 border-indigo-200 dark:bg-indigo-900/30 dark:text-indigo-300 dark:border-indigo-800":"bg-emerald-100 text-emerald-800 border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-300 dark:border-emerald-800",$=r=>r.startsWith("DAY")?e.jsx(xe,{className:"w-3 h-3"}):r.startsWith("NIGHT")?e.jsx(me,{className:"w-3 h-3"}):e.jsx(be,{className:"w-3 h-3"}),j=(r,s,l)=>{r.stopPropagation(),_({type:s,id:l}),g(null)};o.useEffect(()=>{if(!d)return;(async()=>{D(!0);try{if(d.type==="note"){const{data:s}=await p.from("personal_notes").select("*").eq("id",d.id).single();g(s)}else if(d.type==="pm"){const{data:s}=await p.from("pm_plans").select("*, equipment(name, code)").eq("id",d.id).single();g(s)}else if(d.type==="workOrder"){const{data:s}=await p.from("work_orders").select("*").eq("id",d.id).single();g(s?{...s,equipCode:s.equipment_code,equipName:s.equipment_name,equipLocalName:s.local_name,failureDesc:s.failure_description,requester:s.requester_name,reportDate:s.request_date,reportTime:s.request_time,workCategory:s.work_category,workType:s.work_type,actionDesc:s.action_taken,labor:s.labor_details,labor_details:s.labor_details,parts:s.used_parts,used_parts:s.used_parts,docs:s.attachments,attachments:s.attachments}:null)}else if(d.type==="report"){const{data:s}=await p.from("shift_reports").select("*").eq("id",d.id).single();g((s==null?void 0:s.full_data)||null)}}catch(s){console.error("Fetch detail error:",s),g(null)}finally{D(!1)}})()},[d]);const I=()=>{_(null),g(null)};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-primary/10 p-3 rounded-xl text-primary",children:e.jsx(re,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-gray-800 dark:text-white",children:"تقویم جامع نت"}),e.jsx("p",{className:"text-sm text-gray-500",children:"مشاهده شیفت‌ها، برنامه‌ها و گزارشات روزانه"})]})]}),e.jsxs("div",{className:"w-full lg:w-auto flex flex-wrap items-center gap-3 bg-gray-50 dark:bg-gray-900 p-3 rounded-2xl border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 border-l pl-3 dark:border-gray-700",children:[e.jsx("button",{onClick:J,className:"p-2 hover:bg-white dark:hover:bg-gray-800 rounded-lg transition shadow-sm border dark:border-gray-700",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsx("button",{onClick:K,className:"p-2 hover:bg-white dark:hover:bg-gray-800 rounded-lg transition shadow-sm border dark:border-gray-700",children:e.jsx(ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:m,onChange:r=>f(parseInt(r.target.value)),className:"bg-white dark:bg-gray-800 border dark:border-gray-700 p-2 rounded-xl text-sm font-bold outline-none focus:ring-2 focus:ring-primary/20",children:R.map((r,s)=>e.jsx("option",{value:s+1,children:r},s))}),e.jsx("select",{value:u,onChange:r=>y(parseInt(r.target.value)),className:"bg-white dark:bg-gray-800 border dark:border-gray-700 p-2 rounded-xl text-sm font-bold outline-none focus:ring-2 focus:ring-primary/20",children:H.map(r=>e.jsx("option",{value:r,children:r},r))}),e.jsx("button",{onClick:()=>{const r=W();y(parseInt(r.split("/")[0])),f(parseInt(r.split("/")[1]))},className:"p-2 text-xs font-bold text-primary hover:bg-primary/5 rounded-lg transition",children:"امروز"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-xs px-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-blue-500"}),e.jsx("span",{children:"یادداشت شخصی"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-orange-500"}),e.jsx("span",{children:"برنامه نت (PM)"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-red-500"}),e.jsx("span",{children:"دستور کار باز"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-green-500"}),e.jsx("span",{children:"گزارش تولید"})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden flex flex-col",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"min-w-[800px]",children:[e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50",children:B.map((r,s)=>e.jsx("div",{className:`py-3 text-center text-sm font-bold ${s===6?"text-red-500":"text-gray-600 dark:text-gray-300"}`,children:r},s))}),e.jsxs("div",{className:"grid grid-cols-7 auto-rows-fr",children:[Array.from({length:N}).map((r,s)=>e.jsx("div",{className:"bg-gray-50/30 dark:bg-gray-900/20 border-b border-l dark:border-gray-700 min-h-[120px]"},`empty-${s}`)),Q.map(r=>{const s=`${u}/${String(m).padStart(2,"0")}/${String(r).padStart(2,"0")}`,l=V(s),x=s===v,b=(N+r-1)%7===6,n=c[s];return e.jsxs("div",{onClick:()=>w(s),className:`
                                    p-2 min-h-[120px] relative transition-all hover:bg-gray-50 dark:hover:bg-gray-700/30 cursor-pointer group
                                    ${x?"bg-blue-50/50 dark:bg-blue-900/10 border-2 border-primary shadow-sm z-10":"border-b border-l dark:border-gray-700"}
                                `,children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:`text-lg font-black ${x?"text-primary":b?"text-red-500":"text-gray-700 dark:text-gray-200"}`,children:te(r)}),x&&e.jsx("span",{className:"text-[9px] bg-primary text-white px-1.5 py-0.5 rounded-md font-bold",children:"امروز"})]}),e.jsx("div",{className:"space-y-1 mb-2",children:["A","B","C"].map(h=>{const a=l[h];return e.jsxs("div",{className:`flex items-center justify-between px-1 py-0.5 rounded text-[8px] font-bold border opacity-80 group-hover:opacity-100 ${S((a==null?void 0:a.type)||"")}`,children:[e.jsxs("span",{children:[h,": ",a==null?void 0:a.label.split(" ")[0]]}),$((a==null?void 0:a.type)||"")]},h)})}),n&&e.jsxs("div",{className:"flex gap-1 justify-end flex-wrap",children:[n.notes.length>0&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 shadow-sm",title:`${n.notes.length} یادداشت`}),n.pms.length>0&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500 shadow-sm",title:`${n.pms.length} برنامه نت`}),n.workOrders.length>0&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 shadow-sm",title:`${n.workOrders.length} دستور کار`}),n.reports.length>0&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 shadow-sm",title:"گزارش ثبت شده"})]})]},r)}),Array.from({length:(7-(N+q)%7)%7}).map((r,s)=>e.jsx("div",{className:"bg-gray-50/30 dark:bg-gray-900/20 border-b border-l dark:border-gray-700"},`fill-${s}`))]})]})})}),i&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"p-6 bg-gradient-to-r from-gray-900 to-gray-800 text-white flex justify-between items-start relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full blur-2xl transform translate-x-1/2 -translate-y-1/2"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx("h2",{className:"text-3xl font-black mb-1",children:i}),e.jsx("p",{className:"text-sm opacity-80 font-medium",children:"داشبورد وضعیت روزانه"})]}),e.jsx("button",{onClick:()=>w(null),className:"p-2 bg-white/10 hover:bg-white/20 rounded-full transition relative z-10",children:e.jsx(z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 bg-gray-50 dark:bg-gray-900/50",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsxs("h3",{className:"font-bold text-gray-700 dark:text-gray-200 mb-3 flex items-center gap-2 text-sm",children:[e.jsx(de,{className:"w-4 h-4 text-primary"})," شیفت‌های کاری امروز"]}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["A","B","C"].map(r=>{const s=V(i)[r];return e.jsxs("div",{className:`p-3 rounded-xl border text-center ${S((s==null?void 0:s.type)||"")}`,children:[e.jsxs("div",{className:"text-xs font-bold opacity-70 mb-1",children:["شیفت ",r]}),e.jsx("div",{className:"font-black text-sm",children:s==null?void 0:s.label}),e.jsx("div",{className:"mt-1",children:$((s==null?void 0:s.type)||"")})]},r)})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-700 dark:text-gray-200 mb-3 flex items-center gap-2 text-sm",children:[e.jsx(le,{className:"w-4 h-4 text-blue-500"})," یادداشت‌ها و یادآوری‌ها"]}),((M=c[i])==null?void 0:M.notes.length)>0?e.jsx("div",{className:"space-y-2",children:c[i].notes.map(r=>e.jsxs("div",{onClick:s=>j(s,"note",r.id),className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-xl border border-blue-100 dark:border-blue-800 flex justify-between items-center cursor-pointer hover:bg-blue-100 dark:hover:bg-blue-900/30 transition",children:[e.jsx("span",{className:`text-sm ${r.is_completed?"line-through text-gray-400":"text-gray-700 dark:text-gray-200"}`,children:r.title}),r.is_completed&&e.jsx(F,{className:"w-4 h-4 text-green-500"})]},r.id))}):e.jsx("div",{className:"text-center p-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl text-xs text-gray-400",children:"یادداشتی وجود ندارد"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-700 dark:text-gray-200 mb-3 flex items-center gap-2 text-sm",children:[e.jsx(ne,{className:"w-4 h-4 text-orange-500"})," برنامه نت (PM)"]}),((O=c[i])==null?void 0:O.pms.length)>0?e.jsx("div",{className:"space-y-2",children:c[i].pms.map(r=>{var s;return e.jsxs("div",{onClick:l=>j(l,"pm",r.id),className:"bg-orange-50 dark:bg-orange-900/20 p-3 rounded-xl border border-orange-100 dark:border-orange-800 cursor-pointer hover:bg-orange-100 dark:hover:bg-orange-900/30 transition",children:[e.jsx("div",{className:"font-bold text-sm text-gray-800 dark:text-gray-200",children:r.title}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:(s=r.equipment)==null?void 0:s.name})]},r.id)})}):e.jsx("div",{className:"text-center p-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl text-xs text-gray-400",children:"برنامه‌ای وجود ندارد"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-700 dark:text-gray-200 mb-3 flex items-center gap-2 text-sm",children:[e.jsx(ie,{className:"w-4 h-4 text-red-500"})," دستور کارهای ثبت شده"]}),((E=c[i])==null?void 0:E.workOrders.length)>0?e.jsx("div",{className:"space-y-2",children:c[i].workOrders.map(r=>e.jsxs("div",{onClick:s=>j(s,"workOrder",r.id),className:"bg-white dark:bg-gray-800 p-3 rounded-xl border border-gray-200 dark:border-gray-700 flex justify-between items-center shadow-sm cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm",children:r.equipment_name||"تجهیز عمومی"}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5 truncate max-w-[200px]",children:r.failure_description})]}),e.jsx("span",{className:`text-[10px] px-2 py-1 rounded-full font-bold ${r.status==="FINISHED"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:r.status==="FINISHED"?"تکمیل":"باز"})]},r.id))}):e.jsx("div",{className:"text-center p-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl text-xs text-gray-400",children:"دستور کاری ثبت نشده"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-gray-700 dark:text-gray-200 mb-3 flex items-center gap-2 text-sm",children:[e.jsx(oe,{className:"w-4 h-4 text-green-500"})," گزارشات تولید"]}),((A=c[i])==null?void 0:A.reports.length)>0?e.jsx("div",{className:"space-y-2",children:c[i].reports.map(r=>e.jsxs("div",{onClick:s=>j(s,"report",r.id),className:"bg-green-50 dark:bg-green-900/20 p-3 rounded-xl border border-green-100 dark:border-green-800 flex justify-between items-center cursor-pointer hover:bg-green-100 dark:hover:bg-green-900/30 transition",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-sm",children:["شیفت ",r.shift_name]}),e.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:["(",r.tracking_code,")"]})]}),e.jsxs("div",{className:"text-xs font-mono",children:["A: ",r.total_production_a," | B: ",r.total_production_b]})]},r.id))}):e.jsx("div",{className:"text-center p-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl text-xs text-gray-400",children:"گزارشی ثبت نشده"})]})]})]})}),d&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 animate-fadeIn",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex-none flex justify-between items-center p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-800",children:[e.jsxs("h3",{className:"font-bold text-lg",children:[d.type==="note"&&"مشاهده یادداشت",d.type==="pm"&&"مشاهده برنامه نت",d.type==="workOrder"&&"مشاهده دستور کار",d.type==="report"&&"مشاهده گزارش شیفت"]}),e.jsx("button",{onClick:I,className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full transition",children:e.jsx(z,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 min-h-[200px]",children:C?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ce,{className:"w-10 h-10 animate-spin text-primary"})}):d.type==="note"&&t?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"عنوان:"})," ",e.jsx("span",{className:"font-bold",children:t.title})]}),t.content&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"محتوا:"})," ",e.jsx("p",{className:"mt-1 whitespace-pre-wrap",children:t.content})]}),((T=t.tags)==null?void 0:T.length)>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"برچسب‌ها:"})," ",t.tags.join("، ")]}),t.reminder_date&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"یادآوری:"})," ",t.reminder_date," ",t.reminder_time||""]}),t.is_completed&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(F,{className:"w-4 h-4"})," انجام شده"]})]}):d.type==="pm"&&t?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"عنوان:"})," ",e.jsx("span",{className:"font-bold",children:t.title})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"تجهیز:"})," ",((L=t.equipment)==null?void 0:L.name)||t.equipName||"-"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"تاریخ اجرا:"})," ",t.next_run_date]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"دوره:"})," ",t.frequency_type," هر ",t.frequency_value]}),t.description&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-500",children:"توضیحات:"})," ",e.jsx("p",{className:"mt-1",children:t.description})]})]}):d.type==="workOrder"&&t?e.jsx("div",{className:"bg-gray-100 dark:bg-black/20 rounded-xl overflow-hidden",children:e.jsx(he,{initialData:t,isViewOnly:!0})}):d.type==="report"&&t?e.jsx("div",{className:"rounded-xl overflow-hidden",children:e.jsx(pe,{reportData:t,adminAvatar:null,onBack:I})}):!C&&!t?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"اطلاعاتی یافت نشد."}):null})]})})]})};export{qe as WorkCalendar,qe as default};
