import{u as Ie,r as c,h as O,bs as $e,bt as J,j as e,C as Me,bu as Pe,W as Fe,X as Ue,aq as Be,a0 as We,bm as ze,b0 as Ge,A as Je,d as V,a8 as ie,bn as He,a6 as H,ae as q,V as ee,ar as Ye,Y as ce,F as Ke,w as D,bv as Qe,bw as Xe,s as Ze,bx as Oe,am as Ve,ay as ea,by as aa,bz as ue,af as ta}from"./index-Ba5jVD6p.js";import{P as ra}from"./paperclip-CYuFmfPe.js";const I=({options:n,value:g,onChange:s,placeholder:S,disabled:b,className:d,displayMode:j="LABEL"})=>{var $;const[p,k]=c.useState(!1),[w,f]=c.useState(""),C=c.useRef(null);c.useEffect(()=>{if(!p){const u=n.find(h=>h.value===g);f(u?j==="VALUE"?u.value:u.label:g||"")}},[g,p,n,j]),c.useEffect(()=>{const u=h=>{if(C.current&&!C.current.contains(h.target)){k(!1);const y=n.find(E=>E.value===g);f(y?j==="VALUE"?y.value:y.label:g||"")}};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[g,n,j]);const N=n.filter(u=>u.label.toLowerCase().includes(w.toLowerCase())||u.value.toLowerCase().includes(w.toLowerCase()));return e.jsxs("div",{className:`relative ${d}`,ref:C,children:[e.jsxs("div",{className:"relative",title:g?($=n.find(u=>u.value===g))==null?void 0:$.label:"",children:[e.jsx("input",{type:"text",placeholder:S,value:w,onChange:u=>{f(u.target.value),k(!0)},onFocus:()=>!b&&k(!0),disabled:b,className:`w-full p-2.5 pr-8 border rounded-xl outline-none focus:ring-2 focus:ring-primary/20 ${b?"bg-gray-100 text-gray-500 cursor-not-allowed":"bg-white dark:bg-gray-700"}`}),b?e.jsx(Ve,{className:"absolute left-2 top-3 w-4 h-4 text-gray-400"}):e.jsx(ea,{className:"absolute left-2 top-3 w-4 h-4 text-gray-400"})]}),p&&!b&&e.jsx("div",{className:"absolute top-full right-0 left-0 mt-1 max-h-60 overflow-y-auto bg-white dark:bg-gray-800 border dark:border-gray-600 rounded-xl shadow-lg z-50 animate-fadeIn",children:N.length>0?N.map(u=>e.jsxs("div",{className:"p-2.5 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer text-sm border-b dark:border-gray-700 last:border-0 flex flex-col",onClick:()=>{s(u.value),k(!1),f(j==="VALUE"?u.value:u.label)},children:[e.jsx("span",{className:"font-bold",children:u.value}),e.jsx("span",{className:"text-xs text-gray-500",children:u.label})]},u.value)):e.jsx("div",{className:"p-3 text-center text-gray-400 text-xs",children:"موردی یافت نشد"})})]})},Y=n=>{if(!n||!n.includes(":"))return 0;const[g,s]=n.split(":").map(Number);return g*60+s},ae=n=>n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(n)?n:null,da=({initialData:n,onProcessComplete:g,isViewOnly:s=!1})=>{const S=Ie(),b=JSON.parse(localStorage.getItem("currentUser")||"{}"),d=!!n||s,j=s?"مشاهده دستور کار":d?"تکمیل دستور کار":"ثبت درخواست کار",[p,k]=c.useState("GENERAL"),[w,f]=c.useState(null),[C,N]=c.useState(null),[$,u]=c.useState(!1),[h,y]=c.useState(null),[E,te]=c.useState(!1),[T,me]=c.useState([]),[M,xe]=c.useState([]),[P,ge]=c.useState([]),[F,be]=c.useState([]),[pe,he]=c.useState([]),[fe,je]=c.useState([]),[Ne,K]=c.useState([]),[ye,U]=c.useState([]),re=c.useRef(null),[t,m]=c.useState({equipCode:"",equipName:"",equipLocalName:"",locationId:"",locationDetail:"",productionLine:"",requester:b.fullName||"کاربر ناشناس",reportDate:O(),reportTime:$e(),shift:"",workCategory:"MECHANICAL",workType:"REPAIR",priority:"NORMAL",failureDesc:"",actionDesc:"",startDate:O(),startTime:"",endDate:O(),endTime:"",downtime:"",repairTime:""}),[L,B]=c.useState([]),[_,R]=c.useState([]),[W,Q]=c.useState([]);c.useEffect(()=>{(async()=>{const r=await D("equipment"),l=await D("equipment_local_names"),o=await D("locations"),i=await D("personnel"),x=await D("parts");xe(r),ge(l),K(r),U(l),he(o),je(i),be(x),me(await D("measurement_units"))})(),n&&(m(r=>({...r,...n,downtime:typeof n.downtime=="number"?J(n.downtime):n.downtime,repairTime:typeof n.repairTime=="number"?J(n.repairTime):n.repairTime})),(n.labor||n.labor_details)&&B(n.labor||n.labor_details||[]),(n.parts||n.used_parts)&&R(n.parts||n.used_parts||[]),(n.docs||n.attachments)&&Q(n.docs||n.attachments||[]))},[n]);const ve=a=>{const r=M.find(l=>l.code===a);if(!r){m(l=>({...l,equipCode:a,equipName:"",locationId:""})),U(P);return}if(m(l=>({...l,equipCode:a,equipName:r.name,locationId:r.location_id||""})),r.class_id&&r.group_id){const l=P.filter(o=>o.class_id===r.class_id&&o.group_id===r.group_id);U(l)}else U(P)},ke=a=>{const r=P.find(l=>l.local_name===a);if(m(l=>({...l,equipLocalName:a})),r&&r.class_id&&r.group_id){const l=M.filter(o=>o.class_id===r.class_id&&o.group_id===r.group_id);K(l)}else K(M)},se=a=>{const r=window.SpeechRecognition||window.webkitSpeechRecognition;if(!r){alert("مرورگر شما از قابلیت تبدیل گفتار به نوشتار پشتیبانی نمی‌کند.");return}if(h===a){y(null);return}const l=new r;l.lang="fa-IR",l.continuous=!1,l.interimResults=!1,l.onstart=()=>y(a),l.onend=()=>y(null),l.onresult=o=>{const i=o.results[0][0].transcript;m(x=>({...x,[a]:x[a]?`${x[a]} ${i}`:i}))},l.start()},we=()=>{B([...L,{id:Math.random().toString(),name:"",startDate:t.startDate,startTime:t.startTime||"08:00",endDate:t.endDate,endTime:t.endTime||"16:00",durationMinutes:0}])},A=(a,r,l)=>{B(o=>o.map(i=>{if(i.id!==a)return i;const x={...i,[r]:l};return["startDate","startTime","endDate","endTime"].includes(r)&&(x.durationMinutes=aa(x.startDate,x.startTime,x.endDate,x.endTime)),x}))},Ce=()=>{var a;R([..._,{id:Math.random().toString(),code:"",name:"",qty:1,unit:((a=T[0])==null?void 0:a.title)||"عدد"}])},le=(a,r,l)=>{R(o=>o.map(i=>i.id===a?{...i,[r]:l}:i))},ne=(a,r,l)=>{let o;l==="CODE"?o=F.find(i=>i.code===r):o=F.find(i=>i.name===r),R(i=>i.map(x=>{var z;if(x.id!==a)return x;if(o){const G=T.find(v=>v.id===o.consumption_unit_id)||T.find(v=>v.id===o.stock_unit_id),Z=G?G.title:((z=T[0])==null?void 0:z.title)||"عدد";return{...x,code:o.code||"",name:o.name||"",unit:Z}}return{...x,[l==="CODE"?"code":"name"]:r}}))},Te=a=>{if(a.target.files&&a.target.files.length>0){const r=Array.from(a.target.files).map(l=>({id:Math.random().toString(),name:l.name}));Q(l=>[...l,...r]),a.target.value=""}},X=(a,r)=>{a(l=>l.filter(o=>o.id!==r))},Le=()=>{if(s)return null;if(!t.shift)return"لطفا شیفت کاری را انتخاب کنید.";if(!t.equipCode)return"لطفا کد تجهیز را انتخاب کنید.";if(!t.equipLocalName)return"لطفا نام محلی تجهیز را مشخص کنید.";if(!t.productionLine)return"لطفا خط تولید را مشخص کنید.";if(!t.locationId)return"لطفا محل استقرار را مشخص کنید.";if(!t.workCategory)return"لطفا نوع کار (دیسیپلین) را مشخص کنید.";if(!t.failureDesc)return"شرح خرابی الزامی است.";if(d){if(!t.actionDesc)return"اقدام صورت گرفته الزامی است.";if(!t.startDate||!t.startTime||!t.endDate||!t.endTime)return"لطفا زمان‌بندی کار را کامل وارد کنید.";if(!t.downtime||!t.repairTime)return"مدت توقف و زمان خالص تعمیر الزامی است.";if(ue(t.startDate)||ue(t.endDate))return"تاریخ شروع و پایان نمی‌تواند بزرگتر از تاریخ امروز باشد.";if(ta(t.startDate,t.startTime,t.endDate,t.endTime)===1)return"خطا: تاریخ و ساعت پایان نمی‌تواند کوچکتر از تاریخ و ساعت شروع باشد.";if(_.some(r=>r.qty<=0))return"تعداد قطعات مصرفی باید بزرگتر از صفر باشد."}return null},de=()=>s?!0:!(!t.shift||!t.equipCode||!t.equipLocalName||!t.productionLine||!t.locationId||!t.workCategory||!t.priority||!t.workType||!t.failureDesc||d&&(!t.actionDesc||!t.downtime||!t.repairTime)),qe=async a=>{var o;if(a.preventDefault(),s)return;N(null);const r=Le();if(r){N(r),window.scrollTo(0,0);return}if(!window.confirm(d?"آیا از پایان کار و ثبت نهایی اطمینان دارید؟":"آیا از ثبت درخواست و ارسال به کارتابل اطمینان دارید؟"))return;const l={...t,downtime:d?Y(t.downtime):0,repairTime:d?Y(t.repairTime):0,labor:L,parts:_,docs:W};if(d&&g)g(l);else{te(!0);try{const i=new Date,x=Qe(i.getFullYear(),i.getMonth()+1,i.getDate()),z=String(x.jy).substring(2),G=String(x.jm).padStart(2,"0"),Z=`W${z}${G}`,v=await Xe(Z),Se=ae(b.id),Ee=ae((o=M.find(Ae=>Ae.code===t.equipCode))==null?void 0:o.id),_e=ae(t.locationId),Re={tracking_code:v,requester_id:Se,requester_name:b.fullName,request_date:t.reportDate,request_time:t.reportTime,shift:t.shift,equipment_id:Ee,equipment_code:t.equipCode,equipment_name:t.equipName,local_name:t.equipLocalName,location_id:_e,location_details:t.locationDetail,production_line:t.productionLine,work_category:t.workCategory,work_type:t.workType,priority:t.priority,failure_description:t.failureDesc,action_taken:t.actionDesc,downtime:d?Y(t.downtime):0,repair_time:d?Y(t.repairTime):0,labor_details:L,used_parts:_,attachments:W,status:"REQUEST"},{error:oe}=await Ze.from("work_orders").insert([Re]);if(oe)throw console.error("Database Insert Error:",oe),new Error("خطا در ذخیره دستور کار در دیتابیس.");Oe("WORK_ORDER",l,b,v,`درخواست کار: ${t.equipName||t.equipLocalName} - ${t.failureDesc.substring(0,30)}...`)?(u(!0),f(v)):N("خطا در ایجاد فرآیند. لطفا دوباره تلاش کنید.")}catch(i){console.error(i),N("خطا: "+(i.message||"خطا در برقراری ارتباط با سرور"))}finally{te(!1)}}},De=[{id:"GENERAL",label:"اطلاعات اصلی",icon:Be},{id:"LABOR",label:"کارکرد نفرات",icon:We,hidden:!d},{id:"PARTS",label:"قطعات مصرفی",icon:ze,hidden:!d},{id:"DOCS",label:"مستندات",icon:Ge}];return w?e.jsx("div",{className:"max-w-2xl mx-auto pt-8 pb-20 px-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden animate-fadeIn",children:[e.jsxs("div",{className:"bg-green-600 p-6 text-center text-white",children:[e.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm",children:e.jsx(Me,{className:"w-10 h-10 text-white"})}),e.jsx("h2",{className:"text-2xl font-bold mb-1",children:$?"درخواست ثبت و وارد کارتابل شد":"درخواست ثبت شد"}),e.jsx("p",{className:"opacity-90 font-mono text-lg",children:w})]}),e.jsxs("div",{className:"p-6 space-y-3",children:[e.jsxs("button",{onClick:()=>S("/work-orders"),className:"w-full bg-white border border-gray-200 dark:bg-gray-700 py-3.5 rounded-xl flex items-center justify-center gap-2 font-medium hover:bg-gray-50 dark:hover:bg-gray-600",children:[e.jsx(Pe,{className:"w-5 h-5"})," بازگشت به لیست دستور کارها"]}),e.jsx("button",{onClick:()=>S("/"),className:"w-full text-gray-500 py-2 text-sm",children:"بازگشت به داشبورد"})]})]})}):e.jsxs("div",{className:"max-w-4xl mx-auto pb-24",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 sticky top-0 bg-gray-50 dark:bg-gray-900 z-20 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"w-8 h-8 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:j}),d&&!s&&e.jsx("span",{className:"bg-blue-100 text-blue-700 px-2 py-0.5 rounded text-xs font-bold",children:"حالت اجرایی"})]})]}),e.jsx("button",{onClick:()=>S("/work-orders"),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:e.jsx(Ue,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm mb-6 sticky top-16 z-10 border border-gray-200 dark:border-gray-700 overflow-x-auto",children:e.jsx("div",{className:"flex min-w-max",children:De.filter(a=>!a.hidden).map(a=>e.jsxs("button",{type:"button",onClick:()=>k(a.id),className:`flex-1 py-4 px-6 flex items-center justify-center gap-2 text-sm font-bold transition-all border-b-4 
                        ${p===a.id?"border-primary text-primary bg-primary/5":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(a.icon,{className:"w-5 h-5"})," ",a.label]},a.id))})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm overflow-hidden",children:e.jsxs("form",{onSubmit:qe,className:"p-6",children:[C&&e.jsxs("div",{className:"bg-red-50 text-red-600 p-3 rounded-lg mb-6 flex items-start gap-3 text-sm animate-pulse border border-red-100",children:[e.jsx(Je,{className:"w-5 h-5 flex-shrink-0 mt-0.5"}),e.jsx("span",{children:C})]}),p==="GENERAL"&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 bg-gray-50 dark:bg-gray-700/50 p-4 rounded-xl border border-gray-100 dark:border-gray-600",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1",children:"درخواست کننده"}),e.jsx("span",{className:"font-bold text-sm",children:t.requester})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1",children:"تاریخ گزارش"}),e.jsx("span",{className:"font-bold text-sm font-mono",children:t.reportDate})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-500 mb-1",children:"ساعت گزارش"}),e.jsx("span",{className:"font-bold text-sm font-mono",children:t.reportTime})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("label",{className:"text-xs text-gray-500 mb-1",children:["شیفت کاری ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,value:t.shift,onChange:a=>m({...t,shift:a.target.value}),disabled:d||s,className:`text-sm font-bold border rounded outline-none ${d||s?"bg-transparent border-none cursor-not-allowed":"bg-white dark:bg-gray-800 p-1 cursor-pointer"}`,children:[e.jsx("option",{value:"",children:"انتخاب..."}),e.jsx("option",{value:"DayWork",children:"روزکار"}),e.jsx("option",{value:"A",children:"شیفت A"}),e.jsx("option",{value:"B",children:"شیفت B"}),e.jsx("option",{value:"C",children:"شیفت C"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700/30 p-4 rounded-xl border border-gray-100 dark:border-gray-700 space-y-4",children:[e.jsx("h3",{className:"text-sm font-bold text-gray-500 mb-2",children:"مشخصات تجهیز"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:["کد تجهیز ",e.jsx("span",{className:"text-red-500",children:"*"})]}),d||s?e.jsx("input",{type:"text",value:t.equipCode,disabled:!0,className:"w-full p-2.5 border rounded-xl bg-gray-200 dark:bg-gray-600 cursor-not-allowed"}):e.jsx(I,{value:t.equipCode,options:Ne.map(a=>({value:a.code,label:`${a.code} - ${a.name}`})),onChange:ve,placeholder:"جستجو کد تجهیز...",displayMode:"VALUE"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"نام تجهیز"}),e.jsx("input",{type:"text",readOnly:!0,value:t.equipName,className:"w-full p-2.5 border rounded-xl bg-gray-200 dark:bg-gray-600 cursor-not-allowed opacity-70",placeholder:"پس از انتخاب کد پر می‌شود"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:["نام محلی تجهیز ",e.jsx("span",{className:"text-red-500",children:"*"})]}),d||s?e.jsx("div",{title:t.equipLocalName,children:e.jsx("input",{type:"text",value:t.equipLocalName,disabled:!0,className:"w-full p-2.5 border rounded-xl bg-gray-200 dark:bg-gray-600 cursor-not-allowed"})}):e.jsx("div",{title:t.equipLocalName,children:e.jsx(I,{value:t.equipLocalName,options:ye.map(a=>({value:a.local_name,label:a.local_name})),onChange:ke,placeholder:"جستجو نام محلی..."})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:"محل وقوع"}),e.jsx("input",{type:"text",disabled:d||s,value:t.locationDetail,onChange:a=>m({...t,locationDetail:a.target.value}),placeholder:"مثال: طبقه دوم، نوار نقاله...",className:`w-full p-2.5 border rounded-xl outline-none ${d||s?"bg-gray-200 dark:bg-gray-600 cursor-not-allowed":"bg-white dark:bg-gray-700"}`})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:["خط تولید ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,disabled:d||s,value:t.productionLine,onChange:a=>m({...t,productionLine:a.target.value}),className:`w-full p-2.5 border rounded-xl outline-none ${d||s?"bg-gray-200 dark:bg-gray-600 cursor-not-allowed":"bg-white dark:bg-gray-700"}`,children:[e.jsx("option",{value:"",children:"انتخاب کنید"}),e.jsx("option",{value:"Line A",children:"Line A"}),e.jsx("option",{value:"Line B",children:"Line B"}),e.jsx("option",{value:"Line A&B",children:"Line A&B"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:["محل استقرار ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{disabled:d||s,value:t.locationId,onChange:a=>m({...t,locationId:a.target.value}),className:`w-full p-2.5 border rounded-xl outline-none ${d||s?"bg-gray-200 dark:bg-gray-600 cursor-not-allowed":"bg-white dark:bg-gray-700"}`,children:[e.jsx("option",{value:"",children:"انتخاب کنید..."}),pe.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:["نوع فعالیت ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,disabled:d||s,value:t.workType,onChange:a=>m({...t,workType:a.target.value}),className:`w-full p-2.5 border rounded-xl outline-none ${d||s?"bg-gray-200 cursor-not-allowed":"bg-white dark:bg-gray-700"}`,children:[e.jsx("option",{value:"REPAIR",children:"تعمیرات اضطراری (EM)"}),e.jsx("option",{value:"PM",children:"نت پیشگیرانه (PM)"}),e.jsx("option",{value:"PROJECT",children:"پروژه / اصلاح"}),e.jsx("option",{value:"INSPECTION",children:"بازرسی فنی"}),e.jsx("option",{value:"SERVICE",children:"سرویس عمومی"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:["نوع کار (دیسیپلین) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,disabled:d||s,value:t.workCategory,onChange:a=>m({...t,workCategory:a.target.value}),className:`w-full p-2.5 border rounded-xl outline-none ${d||s?"bg-gray-200 cursor-not-allowed":"bg-white dark:bg-gray-700"}`,children:[e.jsx("option",{value:"MECHANICAL",children:"مکانیک"}),e.jsx("option",{value:"ELECTRICAL",children:"برق"}),e.jsx("option",{value:"INSTRUMENTATION",children:"ابزار دقیق"}),e.jsx("option",{value:"FACILITIES",children:"تأسیسات صنعتی"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:["اولیت ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{required:!0,disabled:d||s,value:t.priority,onChange:a=>m({...t,priority:a.target.value}),className:`w-full p-2.5 border rounded-xl outline-none ${d||s?"bg-gray-200 cursor-not-allowed":"bg-white dark:bg-gray-700"}`,children:[e.jsx("option",{value:"NORMAL",children:"عادی"}),e.jsx("option",{value:"URGENT",children:"فوری"}),e.jsx("option",{value:"CRITICAL",children:"بحرانی (توقف تولید)"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:["شرح خرابی / درخواست ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{required:!0,readOnly:d||s,className:`w-full p-4 border rounded-xl h-28 pl-10 resize-none ${d||s?"bg-gray-100 cursor-not-allowed":"bg-gray-50 dark:bg-gray-700"}`,placeholder:"توضیحات خرابی را وارد کنید...",value:t.failureDesc,onChange:a=>m({...t,failureDesc:a.target.value})}),!d&&!s&&e.jsx("button",{type:"button",onClick:()=>se("failureDesc"),className:`absolute left-2 bottom-2 p-2 transition rounded-full ${h==="failureDesc"?"bg-red-100 text-red-600 animate-pulse":"text-gray-400 hover:text-primary"}`,children:h==="failureDesc"?e.jsx(V,{className:"w-5 h-5 animate-spin"}):e.jsx(ie,{className:"w-5 h-5"})})]})]}),d&&e.jsxs("div",{className:"space-y-6 border-t-2 border-dashed border-gray-300 dark:border-gray-600 pt-6 mt-2",children:[e.jsxs("h3",{className:"text-lg font-bold text-primary flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5"})," گزارش انجام کار (تکمیل توسط مجری)"]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1.5 text-gray-700 dark:text-gray-300",children:["اقدام صورت گرفته ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{required:!0,readOnly:s,className:`w-full p-4 border rounded-xl h-28 pl-10 outline-none resize-none ${s?"bg-gray-100 cursor-not-allowed":"bg-white dark:bg-gray-700"}`,placeholder:"شرح کامل تعمیرات انجام شده...",value:t.actionDesc,onChange:a=>m({...t,actionDesc:a.target.value})}),!s&&e.jsx("button",{type:"button",onClick:()=>se("actionDesc"),className:`absolute left-2 bottom-2 p-2 transition rounded-full ${h==="actionDesc"?"bg-red-100 text-red-600 animate-pulse":"text-gray-400 hover:text-primary"}`,children:h==="actionDesc"?e.jsx(V,{className:"w-5 h-5 animate-spin"}):e.jsx(ie,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/10 p-4 rounded-xl border border-blue-100 dark:border-blue-800 space-y-4",children:[e.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-2 gap-6 ${s?"pointer-events-none opacity-80":""}`,children:[e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(H,{label:"تاریخ شروع",value:t.startDate,onChange:a=>m({...t,startDate:a})}),e.jsx(q,{label:"ساعت شروع",value:t.startTime,onChange:a=>m({...t,startTime:a})})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(H,{label:"تاریخ پایان",value:t.endDate,onChange:a=>m({...t,endDate:a})}),e.jsx(q,{label:"ساعت پایان",value:t.endTime,onChange:a=>m({...t,endTime:a})})]})]}),e.jsxs("div",{className:`grid grid-cols-1 sm:grid-cols-2 gap-4 ${s?"pointer-events-none opacity-80":""}`,children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium mb-1.5",children:["مدت توقف (ساعت:دقیقه) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(q,{value:t.downtime,onChange:a=>m({...t,downtime:a})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium mb-1.5",children:["زمان خالص تعمیر (ساعت:دقیقه) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(q,{value:t.repairTime,onChange:a=>m({...t,repairTime:a})})]})]})]})]})]}),p==="LABOR"&&e.jsxs("div",{className:"space-y-4 animate-fadeIn",children:[L.map(a=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-gray-600 space-y-3 relative",children:[!s&&e.jsx("button",{type:"button",onClick:()=>X(B,a.id),className:"absolute top-4 left-4 p-2 text-red-500 hover:bg-red-100 rounded-lg",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1 ml-8",children:[e.jsxs("label",{className:"text-xs text-gray-500 mb-1 block",children:["نام تکنسین ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(I,{value:a.name,options:fe.map(r=>({value:r.full_name,label:r.full_name})),onChange:r=>A(a.id,"name",r),placeholder:"جستجو نام تکنسین...",className:"w-full",disabled:s})]}),e.jsxs("div",{className:`grid grid-cols-2 gap-3 ${s?"pointer-events-none opacity-80":""}`,children:[e.jsx(H,{label:"تاریخ شروع",value:a.startDate,onChange:r=>A(a.id,"startDate",r)}),e.jsx(q,{label:"ساعت شروع",value:a.startTime,onChange:r=>A(a.id,"startTime",r)}),e.jsx(H,{label:"تاریخ پایان",value:a.endDate,onChange:r=>A(a.id,"endDate",r)}),e.jsx(q,{label:"ساعت پایان",value:a.endTime,onChange:r=>A(a.id,"endTime",r)})]}),e.jsx("div",{className:"flex justify-end pt-2 border-t border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1",children:[e.jsx(Ye,{className:"w-3 h-3"}),"مدت کارکرد: ",J(a.durationMinutes)]})})]},a.id)),L.length>0&&e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800 flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-blue-800 dark:text-blue-300",children:"مجموع نفر ساعت:"}),e.jsx("span",{className:"font-black text-lg text-blue-900 dark:text-blue-200",children:J(L.reduce((a,r)=>a+r.durationMinutes,0))})]}),!s&&e.jsxs("button",{type:"button",onClick:we,className:"w-full flex items-center justify-center gap-2 text-primary border-2 border-dashed border-primary/30 px-4 py-3 rounded-lg hover:bg-primary/5 transition",children:[e.jsx(ce,{className:"w-4 h-4"})," افزودن نیروی کار"]})]}),p==="PARTS"&&e.jsxs("div",{className:"space-y-4 animate-fadeIn",children:[_.map(a=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-xl space-y-3 relative",children:[!s&&e.jsx("button",{type:"button",onClick:()=>X(R,a.id),className:"absolute top-4 left-4 p-1.5 text-red-500 hover:bg-red-100 rounded",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"کد قطعه"}),s?e.jsx("input",{type:"text",value:a.code,disabled:!0,className:"w-full p-2 border rounded-lg bg-gray-200 dark:bg-gray-600 cursor-not-allowed"}):e.jsx(I,{value:a.code,options:F.map(r=>({value:r.code,label:`${r.code} - ${r.name}`})),onChange:r=>ne(a.id,r,"CODE"),placeholder:"جستجو کد...",displayMode:"VALUE"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["نام قطعه ",e.jsx("span",{className:"text-red-500",children:"*"})]}),s?e.jsx("input",{type:"text",value:a.name,disabled:!0,className:"w-full p-2 border rounded-lg bg-gray-200 dark:bg-gray-600 cursor-not-allowed"}):e.jsx(I,{value:a.name,options:F.map(r=>({value:r.name,label:r.name})),onChange:r=>ne(a.id,r,"NAME"),placeholder:"جستجو نام قطعه..."})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["تعداد ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:a.qty,onChange:r=>le(a.id,"qty",Number(r.target.value)),className:"w-full p-2 border rounded-lg bg-white dark:bg-gray-800",min:"0.01",step:"0.01",disabled:s})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-500 mb-1",children:["واحد ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{value:a.unit,onChange:r=>le(a.id,"unit",r.target.value),className:"w-full p-2 border rounded-lg bg-white dark:bg-gray-800",disabled:s,children:T.length>0?T.map(r=>e.jsx("option",{value:r.title,children:r.title},r.id)):e.jsx("option",{value:"عدد",children:"عدد"})})]})]})]},a.id)),!s&&e.jsxs("button",{type:"button",onClick:Ce,className:"w-full flex items-center justify-center gap-2 text-primary border-2 border-dashed border-primary/30 px-4 py-3 rounded-lg hover:bg-primary/5 transition",children:[e.jsx(ce,{className:"w-4 h-4"})," افزودن قطعه مصرفی"]})]}),p==="DOCS"&&e.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[!s&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",ref:re,multiple:!0,className:"hidden",onChange:Te}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-8 text-center hover:bg-gray-50 dark:hover:bg-gray-700 transition cursor-pointer",onClick:()=>{var a;return(a=re.current)==null?void 0:a.click()},children:[e.jsx(ra,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2 font-medium",children:"فایل‌ها را اینجا رها کنید یا کلیک کنید"})]})]}),W.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-500",children:"فایل‌های پیوست شده:"}),W.map(a=>e.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-700 border p-3 rounded-lg shadow-sm",children:[e.jsx("span",{className:"text-sm truncate max-w-[200px]",children:a.name}),!s&&e.jsx("button",{type:"button",onClick:()=>X(Q,a.id),className:"text-red-500",children:e.jsx(ee,{className:"w-4 h-4"})})]},a.id))]})]}),!s&&e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-100 dark:border-gray-700 flex justify-end",children:e.jsxs("button",{disabled:!de()||E,type:"submit",className:`bg-primary text-white px-8 py-3 rounded-xl shadow-lg shadow-red-900/20 flex items-center gap-2 hover:bg-red-800 transition transform active:scale-95 ${!de()||E?"opacity-50 cursor-not-allowed bg-gray-400 hover:bg-gray-400 shadow-none":""}`,children:[E?e.jsx(V,{className:"w-5 h-5 animate-spin"}):e.jsx(Ke,{className:"w-5 h-5"}),d?"ثبت و پایان دستور کار":"ثبت درخواست و ارسال به کارتابل"]})})]})})]})};export{da as WorkOrders,da as default};
