import{c as j,r as l,s as o,j as e,aC as E,Y as F,ay as P,aD as q,d as A,V as I,aE as $,t as y,C as M,a6 as z,ae as R}from"./index-Ba5jVD6p.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=j("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=j("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),B=({user:n})=>{const[h,p]=l.useState([]),[N,w]=l.useState([]),[v,b]=l.useState(!1),[k,m]=l.useState(!1),[r,d]=l.useState({}),[c,C]=l.useState(""),[x,_]=l.useState("ALL"),[u,D]=l.useState(!1),[g,S]=l.useState("");l.useEffect(()=>{f()},[n]),l.useEffect(()=>{let a=h;c&&(a=a.filter(t=>t.title.includes(c)||t.content.includes(c))),x==="TODO"&&(a=a.filter(t=>!t.isCompleted)),x==="DONE"&&(a=a.filter(t=>t.isCompleted)),g&&(a=a.filter(t=>t.tags.some(s=>s.includes(g)))),w(a)},[h,c,x,g]);const f=async()=>{b(!0);const{data:a}=await o.from("personal_notes").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});if(a){const t=a.map(s=>({id:s.id,userId:s.user_id,title:s.title,content:s.content,tags:s.tags||[],reminderDate:s.reminder_date,reminderTime:s.reminder_time,isCompleted:s.is_completed,createdAt:s.created_at,reminderSeen:!1}));p(t)}b(!1)},T=async a=>{var t;if(a.preventDefault(),!((t=r.title)!=null&&t.trim())){alert("عنوان یادداشت را وارد کنید.");return}if(!(n!=null&&n.id)){alert("کاربر وارد نشده است. لطفاً دوباره لاگین کنید.");return}try{const s={user_id:n.id,title:(r.title||"").trim(),content:r.content||"",tags:r.tags||[],reminder_date:r.reminderDate||null,reminder_time:r.reminderTime||null,is_completed:r.isCompleted||!1};if(r.id){const{error:i}=await o.from("personal_notes").update(s).eq("id",r.id);if(i)throw i}else{const{error:i}=await o.from("personal_notes").insert([s]);if(i)throw i}m(!1),d({}),f()}catch(s){console.error("ذخیره یادداشت:",s),alert("خطا در ذخیره یادداشت: "+((s==null?void 0:s.message)||(s==null?void 0:s.error_description)||"خطای ناشناخته"))}},L=async a=>{window.confirm("Delete note?")&&(await o.from("personal_notes").delete().eq("id",a),p(t=>t.filter(s=>s.id!==a)))},O=async a=>{const t=!a.isCompleted;p(s=>s.map(i=>i.id===a.id?{...i,isCompleted:t}:i)),await o.from("personal_notes").update({is_completed:t}).eq("id",a.id)};return e.jsxs("div",{className:"max-w-7xl mx-auto pb-20 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-8 h-8 text-primary"}),e.jsx("h1",{className:"text-2xl font-bold",children:"یادداشت‌های شخصی"})]}),e.jsxs("button",{onClick:()=>{d({}),m(!0)},className:"bg-primary text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"})," یادداشت جدید"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden mb-6",children:[e.jsxs("div",{className:"p-4 flex flex-col md:flex-row items-center gap-4 justify-between",children:[e.jsxs("div",{className:"relative flex-1 w-full md:max-w-md",children:[e.jsx(P,{className:"absolute right-3 top-2.5 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"جستجو در یادداشت‌ها...",value:c,onChange:a=>C(a.target.value),className:"w-full pr-10 pl-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 w-full md:w-auto justify-end",children:[e.jsx("div",{className:"flex bg-gray-100 dark:bg-gray-700 p-1 rounded-lg",children:["ALL","TODO","DONE"].map(a=>e.jsx("button",{onClick:()=>_(a),className:`px-3 py-1.5 text-xs font-bold rounded-md transition ${x===a?"bg-white dark:bg-gray-600 shadow-sm text-primary":"text-gray-500"}`,children:a==="ALL"?"همه":a==="TODO"?"انجام نشده":"انجام شده"},a))}),e.jsx("button",{onClick:()=>D(!u),className:`p-2 rounded-lg border transition ${u?"bg-primary/10 border-primary text-primary":"bg-gray-50 dark:bg-gray-700 border-gray-200 dark:border-gray-600 text-gray-500"}`,title:"فیلترها",children:e.jsx(q,{className:"w-5 h-5"})})]})]}),u&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-900 border-t border-gray-100 dark:border-gray-700 p-4 animate-fadeIn",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"برچسب"}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded-lg bg-white dark:bg-gray-800",placeholder:"#تگ",value:g,onChange:a=>S(a.target.value)})]})})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v?e.jsx("div",{className:"col-span-3 text-center p-10",children:e.jsx(A,{className:"w-8 h-8 animate-spin mx-auto"})}):N.map(a=>{var t;return e.jsxs("div",{className:`bg-white dark:bg-gray-800 p-4 rounded-xl shadow-sm border transition hover:shadow-md ${a.isCompleted?"opacity-70":""}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:`font-bold text-lg ${a.isCompleted?"line-through text-gray-500":""}`,children:a.title}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{d(a),m(!0)},className:"p-1.5 hover:bg-gray-100 rounded text-blue-500",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>L(a.id),className:"p-1.5 hover:bg-gray-100 rounded text-red-500",children:e.jsx(I,{className:"w-4 h-4"})})]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4 min-h-[40px]",children:a.content}),e.jsxs("div",{className:"flex justify-between items-center mt-auto",children:[e.jsxs("div",{className:"flex gap-2",children:[a.reminderDate&&e.jsxs("span",{className:"text-xs bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400 px-2 py-1 rounded flex items-center gap-1 font-medium font-sans",children:[e.jsx($,{className:"w-3 h-3 flex-shrink-0"}),a.reminderTime?e.jsxs(e.Fragment,{children:[y(a.reminderTime),e.jsx("span",{className:"text-cyan-500 mx-1",children:"|"})]}):null,y(a.reminderDate)]}),(t=a.tags)==null?void 0:t.map(s=>e.jsxs("span",{className:"text-xs bg-gray-100 px-2 py-1 rounded",children:["#",s]},s))]}),e.jsx("button",{onClick:()=>O(a),className:`p-1.5 rounded-full ${a.isCompleted?"text-green-600 bg-green-50":"text-gray-400 hover:text-green-600"}`,children:a.isCompleted?e.jsx(M,{className:"w-6 h-6"}):e.jsx(V,{className:"w-6 h-6"})})]})]},a.id)})}),k&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm",children:e.jsxs("form",{onSubmit:T,className:"bg-white dark:bg-gray-800 w-full max-w-md rounded-2xl shadow-2xl p-6 space-y-4",children:[e.jsx("h3",{className:"font-bold text-lg",children:r.id?"ویرایش یادداشت":"یادداشت جدید"}),e.jsx("input",{required:!0,placeholder:"عنوان",className:"w-full p-3 border rounded-xl dark:bg-gray-700",value:r.title||"",onChange:a=>d({...r,title:a.target.value})}),e.jsx("textarea",{placeholder:"متن یادداشت...",className:"w-full p-3 border rounded-xl dark:bg-gray-700 h-32",value:r.content||"",onChange:a=>d({...r,content:a.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(z,{label:"تاریخ یادآوری",value:r.reminderDate||"",onChange:a=>d({...r,reminderDate:a}),disableFuture:!1}),e.jsx(R,{label:"ساعت",value:r.reminderTime||"",onChange:a=>d({...r,reminderTime:a})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2 border rounded-lg",children:"انصراف"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-primary text-white rounded-lg",children:"ذخیره"})]})]})})]})};export{B as Notes,B as default};
