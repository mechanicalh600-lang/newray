import{u as M,r,s as y,h as V,j as t,a4 as W,bE as j,bj as $,X as z,bm as H,P as X,ar as Z,bo as q,bF as G,bC as J,aH as O,F as Q,a6 as v,ab as U}from"./index-Ba5jVD6p.js";import{c as Y}from"./reportTemplates-DFawh_qo.js";import{I as ee}from"./info-CFSfHgcC.js";import{R as te}from"./refresh-ccw-7aaP1mjM.js";import{A as ae}from"./arrow-left-D4pnEk66.js";const f=[{id:1,label:"اطلاعات گزارش",icon:ee},{id:2,label:"خوراک",icon:H},{id:3,label:"محصول",icon:X},{id:4,label:"ساعت کارکرد",icon:Z},{id:5,label:"توقفات",icon:q},{id:6,label:"جریان الکتریکی",icon:G},{id:7,label:"هیدروسیکلون",icon:te},{id:8,label:"تیکنر",icon:J}],de=({user:b})=>{const N=M(),[w,l]=r.useState("LIST"),[h,m]=r.useState(1),[p,x]=r.useState([]),[S,u]=r.useState([]),[k,i]=r.useState(!1),[C,D]=r.useState([]),[d,L]=r.useState(""),[n,_]=r.useState(""),[c,A]=r.useState("ALL");r.useEffect(()=>{i(!0),Y("control-room","قالب پیش فرض گزارش اتاق کنترل"),y.from("control_room_reports").select("*").order("created_at",{ascending:!1}).then(({data:e})=>{const a=(e||[]).map(s=>({id:s.id,code:s.tracking_code,date:s.report_date,shift:s.shift,operator:s.operator_name,status:s.status||"تکمیل شده",data:s.full_data||{}}));x(a),u(a)}).finally(()=>i(!1))},[]),r.useEffect(()=>{let e=p;d&&(e=e.filter(a=>a.date>=d)),n&&(e=e.filter(a=>a.date<=n)),c!=="ALL"&&(e=e.filter(a=>a.shift===c)),u(e)},[d,n,c,p]);const[o,g]=r.useState({date:V(),shift:"A"}),R=async e=>{x(a=>a.filter(s=>!e.includes(s.id))),alert("حذف شد (شبیه‌سازی)")},T=()=>{if(!o.date||!o.shift){alert("تاریخ و شیفت الزامی است.");return}U("CR-").then(async e=>{const a={tracking_code:e,report_date:o.date,shift:o.shift,operator_name:b.fullName,status:"تکمیل شده",full_data:o},{error:s}=await y.from("control_room_reports").insert([a]);if(s){alert(`خطا در ثبت: ${s.message}`);return}alert("گزارش ثبت شد.");const K={id:`${Date.now()}`,code:e,date:o.date,shift:o.shift,operator:b.fullName,status:"تکمیل شده",data:o};x(B=>[K,...B]),l("LIST")})},I=[{header:"کد گزارش",accessor:e=>e.code,sortKey:"code"},{header:"تاریخ",accessor:e=>e.date,sortKey:"date"},{header:"شیفت",accessor:e=>e.shift,sortKey:"shift"},{header:"اپراتور",accessor:e=>e.operator,sortKey:"operator"},{header:"وضعیت کلی",accessor:e=>e.status,sortKey:"status"}],E=t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsx("div",{children:t.jsx(v,{label:"از تاریخ",value:d,onChange:L})}),t.jsx("div",{children:t.jsx(v,{label:"تا تاریخ",value:n,onChange:_})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"شیفت"}),t.jsxs("select",{className:"w-full p-2 border rounded-lg bg-white dark:bg-gray-800",value:c,onChange:e=>A(e.target.value),children:[t.jsx("option",{value:"ALL",children:"همه"}),t.jsx("option",{value:"A",children:"شیفت A"}),t.jsx("option",{value:"B",children:"شیفت B"}),t.jsx("option",{value:"C",children:"شیفت C"})]})]})]}),F=e=>{g(e.data||{date:e.date,shift:e.shift}),l("NEW")},P=e=>{g(e.data||{date:e.date,shift:e.shift}),l("NEW")};return w==="LIST"?t.jsx(W,{title:"گزارشات اتاق کنترل",icon:j,data:S,isLoading:k,columns:I,onAdd:()=>l("NEW"),onReload:()=>{i(!0),setTimeout(()=>i(!1),500)},onDelete:R,selectedIds:C,onSelect:D,filterContent:E,exportName:"ControlRoomReports",onEdit:F,onViewDetails:P,onPrint:e=>$(N,"control-room",e)}):t.jsxs("div",{className:"max-w-5xl mx-auto pb-24",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6 sticky top-0 bg-gray-50 dark:bg-gray-900 z-20 py-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(j,{className:"w-8 h-8 text-primary"}),t.jsx("h1",{className:"text-2xl font-bold",children:"ثبت گزارش اتاق کنترل"})]}),t.jsx("button",{onClick:()=>l("LIST"),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:t.jsx(z,{className:"w-6 h-6"})})]}),t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm mb-6 sticky top-16 z-10 border border-gray-200 dark:border-gray-700 overflow-x-auto",children:t.jsx("div",{className:"flex min-w-max",children:f.map(e=>t.jsxs("button",{onClick:()=>m(e.id),className:`flex-1 py-4 px-6 flex items-center justify-center gap-2 text-sm font-bold transition-all border-b-4 
                              ${h===e.id?"border-primary text-primary bg-primary/5":"border-transparent text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:[t.jsx(e.icon,{className:"w-5 h-5"})," ",e.label]},e.id))})}),t.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 min-h-[300px]",children:t.jsx("div",{className:"text-center py-20 text-gray-400",children:"محتوای فرم (شبیه‌سازی شده)"})}),t.jsxs("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200 dark:border-gray-700 mt-6",children:[t.jsxs("button",{onClick:()=>m(e=>Math.max(1,e-1)),disabled:h===1,className:"px-6 py-3 border rounded-xl hover:bg-gray-100 disabled:opacity-50",children:[t.jsx(O,{className:"w-5 h-5"})," مرحله قبل"]}),h===f.length?t.jsxs("button",{onClick:T,className:"bg-primary text-white px-8 py-3 rounded-xl shadow-lg hover:bg-red-800 font-bold flex items-center gap-2",children:[t.jsx(Q,{className:"w-6 h-6"})," ثبت نهایی"]}):t.jsxs("button",{onClick:()=>m(e=>Math.min(f.length,e+1)),className:"px-8 py-3 rounded-xl bg-blue-600 text-white font-bold flex items-center gap-2 hover:bg-blue-700",children:["مرحله بعد ",t.jsx(ae,{className:"w-5 h-5"})]})]})]})};export{de as ControlRoomReport,de as default};
