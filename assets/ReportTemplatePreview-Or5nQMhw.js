import{a3 as P,u as S,r as c,j as t,aH as _,a5 as T,s as N}from"./index-Ba5jVD6p.js";import{a as k}from"./reportTemplates-DFawh_qo.js";const A={shiftreport:"shift_reports","scale-report":"scale_reports","lab-report":"lab_reports","warehouse-report":"warehouse_reports","hse-report":"hse_reports",productionreport:null,"control-room":null},v=(e,a)=>String(a||"").split(".").filter(Boolean).reduce((l,o)=>l==null?void 0:l[o],e),w=e=>e==null||e===""?"---":typeof e=="number"?e.toLocaleString("fa-IR"):typeof e=="boolean"?e?"بله":"خیر":String(e),y=(e,a)=>String(e||"").replace(/\{\{([^}]+)\}\}/g,(l,o)=>{const r=String(o||"").trim();return r?w(v(a,r)??a[r]):""}),p=e=>({fontFamily:(e==null?void 0:e.fontFamily)||"Vazirmatn",fontSize:e==null?void 0:e.fontSize,fontWeight:e!=null&&e.bold?"bold":"normal",fontStyle:e!=null&&e.italic?"italic":"normal",textDecoration:e!=null&&e.underline?"underline":"none",color:e==null?void 0:e.color,textAlign:e==null?void 0:e.align}),E=({el:e,record:a,orgLogo:l})=>{var g,h,b,f,j,x,u;const o={position:"absolute",left:e.layout.x,top:e.layout.y,width:e.layout.width,height:e.layout.height,overflow:"hidden",backgroundColor:e.props.backgroundColor||"transparent",border:e.props.borderWidth>0?`${e.props.borderWidth}px solid ${e.props.borderColor||"#d1d5db"}`:void 0,borderRadius:8},r={...a,row:a,rows:[a]};if(e.type==="HEADER"){const n=((g=e.props.detailsProps)==null?void 0:g.items)||[];return t.jsxs("div",{style:o,className:"p-3 flex items-center justify-between",children:[t.jsx("div",{className:"w-16 h-16 flex items-center justify-center text-xs bg-gray-100 rounded",children:l?t.jsx("img",{src:l,alt:"logo",className:"w-full h-full object-contain"}):"LOGO"}),t.jsxs("div",{className:"text-center flex-1 px-4",children:[t.jsx("h1",{style:p(e.props.titleProps),children:y(((h=e.props.titleProps)==null?void 0:h.text)||"",r)}),t.jsx("h2",{style:p(e.props.subtitleProps),children:y(((b=e.props.subtitleProps)==null?void 0:b.text)||"",r)})]}),t.jsx("div",{className:"w-44 text-xs space-y-1",children:n.map(i=>{var s,d;return t.jsxs("div",{className:"flex items-center justify-between border-b border-dashed border-gray-300 pb-1",children:[t.jsx("span",{style:p((s=e.props.detailsProps)==null?void 0:s.labelStyle),children:i.label}),t.jsx("span",{style:p((d=e.props.detailsProps)==null?void 0:d.valueStyle),children:y(`{{${i.value}}}`,r)})]},i.id)})})]})}if(e.type==="TEXT")return t.jsx("div",{style:o,className:"p-2",children:t.jsx("div",{style:p(e.props.textProps),children:y(((f=e.props.textProps)==null?void 0:f.text)||"",r)})});if(e.type==="STAT_CARD"){const n=e.props.valueField?v(a,e.props.valueField):(j=e.props.valueProps)==null?void 0:j.text;return t.jsxs("div",{style:o,className:"p-3 text-center",children:[t.jsx("div",{style:p(e.props.labelProps),children:(x=e.props.labelProps)==null?void 0:x.text}),t.jsx("div",{style:p(e.props.valueProps),children:w(n)}),(u=e.props.unitProps)!=null&&u.text?t.jsx("div",{style:p(e.props.unitProps),children:e.props.unitProps.text}):null]})}if(e.type==="TABLE"){const n=e.props.columns&&e.props.columns.length>0?e.props.columns:Object.keys(a||{}).slice(0,6).map((s,d)=>({id:`${s}-${d}`,header:s,key:s,align:"right"})),i=[a];return t.jsx("div",{style:o,className:"p-2 overflow-auto",children:t.jsxs("table",{className:"w-full text-xs border-collapse",children:[t.jsx("thead",{children:t.jsx("tr",{className:"bg-gray-100",children:n.map(s=>t.jsx("th",{className:"border p-2",style:{textAlign:s.align||"right"},children:s.header},s.id))})}),t.jsx("tbody",{children:i.map((s,d)=>t.jsx("tr",{children:n.map(m=>t.jsx("td",{className:"border p-2",style:{textAlign:m.align||"right"},children:w(v(s,m.key))},`${m.id}-${d}`))},d))})]})})}return t.jsx("div",{style:o,className:"flex items-center justify-center text-gray-400 text-xs border border-dashed rounded",children:e.type})},C=()=>{const e=P(),a=S(),l=e.state||{},o=l.moduleId||"",r=l.record||null,[g,h]=c.useState(r),[b,f]=c.useState(null),[j,x]=c.useState(!0),u=c.useMemo(()=>o?k(o):null,[o]);return c.useEffect(()=>{(async()=>{if(!(!o||!r)){x(!0);try{const i=A[o];let s=null;if(i&&(r!=null&&r.id)){const{data:m}=await N.from(i).select("*").eq("id",r.id).maybeSingle();s=m||null}const d={...r||{},...s||{},...r&&r.full_data||{},...s&&s.full_data||{}};h(d)}finally{x(!1)}}})()},[o,r]),c.useEffect(()=>{(async()=>{var s;const{data:i}=await N.from("app_settings").select("org_logo").order("created_at",{ascending:!0}).limit(1);f(i&&((s=i[0])==null?void 0:s.org_logo)||null)})()},[]),!r||!o?t.jsxs("div",{className:"max-w-3xl mx-auto py-16 text-center",children:[t.jsx("p",{className:"text-gray-500 mb-4",children:"داده‌ای برای پیش‌نمایش قالب ارسال نشده است."}),t.jsx("button",{onClick:()=>a("/"),className:"px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200",children:"بازگشت"})]}):u?t.jsxs("div",{className:"max-w-7xl mx-auto pb-10 space-y-4",children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border p-3 flex items-center justify-between print:hidden",children:[t.jsxs("button",{onClick:()=>a("/"),className:"px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 flex items-center gap-2",children:[t.jsx(_,{className:"w-4 h-4"}),"بازگشت"]}),t.jsxs("button",{onClick:()=>window.print(),className:"px-4 py-2 rounded-lg bg-primary text-white hover:bg-red-900 flex items-center gap-2",children:[t.jsx(T,{className:"w-4 h-4"}),"چاپ"]})]}),t.jsxs("div",{className:"overflow-auto p-4 bg-gray-100 dark:bg-gray-900 rounded-xl",children:[j&&t.jsx("div",{className:"mb-2 text-xs text-gray-500",children:"در حال بازیابی داده‌های رکورد از دیتابیس..."}),t.jsx("div",{className:"mx-auto bg-white shadow relative",style:{width:"210mm",height:"297mm"},children:u.elements.map(n=>t.jsx(E,{el:n,record:g,orgLogo:b},n.id))})]})]}):t.jsxs("div",{className:"max-w-3xl mx-auto py-16 text-center",children:[t.jsx("p",{className:"text-gray-500 mb-2",children:"برای این ماژول هنوز قالبی ذخیره نشده است."}),t.jsx("button",{onClick:()=>a("/"),className:"px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200",children:"بازگشت"})]})};export{C as ReportTemplatePreview,C as default};
