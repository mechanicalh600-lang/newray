import{r as d,s as T,j as t,bn as _,W as S,ar as A,bK as R,A as B}from"./index-Ba5jVD6p.js";import{R as u,C as b,X as p,Y as y,T as f,B as I,w as L,a as w}from"./BarChart-CG56lHO5.js";import{L as P,a as q}from"./LineChart-BSiQnK8R.js";const O=()=>{const[n,v]=d.useState({mttr:0,mtbf:0,totalDowntime:0,totalBreakdowns:0,availability:0}),[h,k]=d.useState([]),[z,c]=d.useState(!1);d.useEffect(()=>{N()},[]);const N=async()=>{c(!0);try{const{data:e}=await T.from("work_orders").select("request_date, downtime, repair_time, status").eq("work_type","REPAIR").order("request_date",{ascending:!0});if(!e||e.length===0){c(!1);return}const a=e.length,l=e.reduce((s,i)=>s+(i.downtime||0),0),x=e.reduce((s,i)=>s+(i.repair_time||0),0),r=new Date(e[0].created_at),g=Math.max(1,(new Date().getTime()-r.getTime())/(1e3*3600*24))*24*60,j=g-l,D=a>0?x/a:0,C=a>0?j/a:0,K=j/g*100;v({mttr:Math.round(D),mtbf:Math.round(C/60),totalDowntime:Math.round(l/60),totalBreakdowns:a,availability:parseFloat(K.toFixed(2))});const M=e.slice(0,10).map((s,i)=>({name:s.request_date||`WO-${i}`,downtime:s.downtime,repair:s.repair_time}));k(M)}catch(e){console.error(e)}finally{c(!1)}},o=({title:e,value:a,unit:l,icon:x,colorClass:r,desc:m})=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 flex items-start justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-gray-500 text-sm font-medium mb-1",children:e}),t.jsxs("h3",{className:`text-3xl font-black ${r}`,children:[a," ",t.jsx("span",{className:"text-sm text-gray-400 font-normal",children:l})]}),m&&t.jsx("p",{className:"text-xs text-gray-400 mt-2",children:m})]}),t.jsx("div",{className:`p-3 rounded-xl ${r.replace("text-","bg-").replace("600","50")} opacity-80`,children:t.jsx(x,{className:`w-6 h-6 ${r}`})})]});return t.jsxs("div",{className:"max-w-7xl mx-auto pb-20 space-y-6",children:[t.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[t.jsx(_,{className:"text-primary"})," شاخص‌های کلیدی عملکرد (KPIs)"]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[t.jsx(o,{title:"MTTR (میانگین زمان تعمیر)",value:n.mttr,unit:"دقیقه",icon:S,colorClass:"text-orange-600",desc:"زمان متوسط برای رفع یک خرابی"}),t.jsx(o,{title:"MTBF (فاصله بین خرابی‌ها)",value:n.mtbf,unit:"ساعت",icon:A,colorClass:"text-blue-600",desc:"زمان متوسط کارکرد بدون وقفه"}),t.jsx(o,{title:"دسترس‌پذیری تجهیزات",value:n.availability,unit:"%",icon:R,colorClass:"text-green-600",desc:"درصد زمانی که تجهیزات آماده کار بوده‌اند"}),t.jsx(o,{title:"کل توقفات",value:n.totalDowntime,unit:"ساعت",icon:B,colorClass:"text-red-600",desc:"مجموع ساعات توقف خط در بازه زمانی"})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border dark:border-gray-700 h-80",children:[t.jsx("h3",{className:"font-bold mb-4 text-gray-700 dark:text-gray-200",children:"روند خرابی‌ها (دقیقه توقف)"}),t.jsx(u,{width:"100%",height:"100%",children:t.jsxs(P,{data:h,children:[t.jsx(b,{strokeDasharray:"3 3",vertical:!1}),t.jsx(p,{dataKey:"name",fontSize:10}),t.jsx(y,{fontSize:10}),t.jsx(f,{}),t.jsx(q,{type:"monotone",dataKey:"downtime",stroke:"#ef4444",strokeWidth:2,name:"زمان توقف"})]})})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border dark:border-gray-700 h-80",children:[t.jsx("h3",{className:"font-bold mb-4 text-gray-700 dark:text-gray-200",children:"زمان خالص تعمیرات vs توقف"}),t.jsx(u,{width:"100%",height:"100%",children:t.jsxs(I,{data:h,children:[t.jsx(b,{strokeDasharray:"3 3",vertical:!1}),t.jsx(p,{dataKey:"name",fontSize:10}),t.jsx(y,{fontSize:10}),t.jsx(f,{}),t.jsx(L,{}),t.jsx(w,{dataKey:"repair",fill:"#3b82f6",name:"زمان تعمیر",radius:[4,4,0,0]}),t.jsx(w,{dataKey:"downtime",fill:"#ef4444",name:"کل توقف",radius:[4,4,0,0]})]})})]})]})]})};export{O as KPIs,O as default};
