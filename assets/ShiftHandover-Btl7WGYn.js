import{u as bt,r as o,h as Le,w as xt,s as Be,b3 as yt,b4 as Me,j as t,b5 as Ie,X as vt,b6 as jt,ae as wt,a6 as Nt,b7 as kt,ay as le,V as oe,b8 as St,b9 as Ct,ba as At,bb as _t,bc as Tt,bd as Dt,be as Lt,bf as Bt,bg as Mt,bh as It,aH as Ft,d as Rt,F as Ot,b as Et,a4 as Vt,bi as Fe,bj as Wt,bk as h,aK as zt,ab as Pt,bl as $t,z as ie,aa as Kt}from"./index-Ba5jVD6p.js";import{S as Ht}from"./ShiftHandoverReport-ctJHqSqd.js";import{e as Yt}from"./reportTemplates-DFawh_qo.js";import{A as Ut}from"./arrow-left-D4pnEk66.js";import"./share-2-DqqORqgq.js";import"./BarChart-CG56lHO5.js";import"./PieChart-D5hrt51y.js";import"./LineChart-BSiQnK8R.js";import"./refresh-ccw-7aaP1mjM.js";const ns=({user:I})=>{const Re=bt(),[F,C]=o.useState("LIST"),[g,k]=o.useState(1),[K,ce]=o.useState(!1),[H,de]=o.useState([]),[Oe,Y]=o.useState(!1),[Ee,ue]=o.useState(!1),[he,me]=o.useState([]),[U,Ve]=o.useState([]),[We,Xt]=o.useState(!1),[X,pe]=o.useState(null),[ze,Pe]=o.useState(null),[w,$e]=o.useState([]),[R,Ke]=o.useState(""),[O,He]=o.useState("ALL"),[c,A]=o.useState({name:"A",type:"Day1",date:Le(),shiftDuration:"12:00",supervisor:I.id,supervisorName:I.fullName}),[x,E]=o.useState({}),[q,V]=o.useState({}),[v,_]=o.useState({present:"",leave:"",absent:""}),[W,z]=o.useState({lineA:{},lineB:{}}),[G,T]=o.useState({lineA:{},lineB:{}}),[ge,fe]=o.useState({lineA:!0,lineB:!0}),[J,L]=o.useState({lineA:{primary:{active:!1,amp08:"",amp02:"",dens08:"",dens02:"",ballSize:"",barrelCount:"",charges:[]},secondary:{active:!1,amp08:"",amp02:"",dens08:"",dens02:"",ballSize:"",barrelCount:"",charges:[]}},lineB:{primary:{active:!1,amp08:"",amp02:"",dens08:"",dens02:"",ballSize:"",barrelCount:"",charges:[]},secondary:{active:!1,amp08:"",amp02:"",dens08:"",dens02:"",ballSize:"",barrelCount:"",charges:[]}}}),[be,Q]=o.useState({lineA:{primary:{active:!1,activeCyclones:[],pressure08:"",angle08:"",pressure02:"",angle02:""},secondary:{active:!1,activeCyclones:[],pressure08:"",angle08:"",pressure02:"",angle02:""}},lineB:{primary:{active:!1,activeCyclones:[],pressure08:"",angle08:"",pressure02:"",angle02:""},secondary:{active:!1,activeCyclones:[],pressure08:"",angle08:"",pressure02:"",angle02:""}}}),[xe,Z]=o.useState({lineA:{active:!1,single:!1,upper:!1,middle:!1,lower:!1,description:""},lineB:{active:!1,single:!1,upper:!1,middle:!1,lower:!1,description:""}}),[ye,ee]=o.useState({lineA:{active:!1,operator:"",hours:"",cloths:[]},lineB:{active:!1,operator:"",hours:"",cloths:[]},reserve:{active:!1,operator:"",hours:"",cloths:[]}}),[ve,B]=o.useState({lineA:[{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}},{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}},{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}}],lineB:[{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}},{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}},{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}}]}),[je,te]=o.useState({lineA:[{active:!1,operator:"",hours:"",cloths:[]},{active:!1,operator:"",hours:"",cloths:[]}],lineB:[{active:!1,operator:"",hours:"",cloths:[]},{active:!1,operator:"",hours:"",cloths:[]}]}),[we,se]=o.useState({process:[],cleanWater:[]}),[f,S]=o.useState({lineA:{workTime:"",stopTime:"",reason:""},lineB:{workTime:"",stopTime:"",reason:""},generalDescription:[""]}),[Ne,D]=o.useState({nextShiftActions:[""]}),[Ye,ke]=o.useState(!1);o.useEffect(()=>{Yt(),xt("personnel").then($e),Se(),Ue()},[]),o.useEffect(()=>{let e=he;R&&(e=e.filter(s=>s.shift_date===R)),O!=="ALL"&&(e=e.filter(s=>s.shift_type===O)),Ve(e)},[R,O,he]);const Ue=async()=>{const{data:e}=await Be.from("app_users").select("avatar").eq("role","ADMIN").limit(1).single();e&&Pe(e.avatar)},Se=async()=>{ue(!0);try{const s=(await yt()).map(a=>({...a,total_production_a:Number(a.total_production_a),total_production_b:Number(a.total_production_b)}));me(s)}catch(e){console.error("Error loading reports",e)}finally{ue(!1)}},i=F==="VIEW"&&X||F==="FORM"&&We,Ce=e=>{if(i)return!0;if(e===2){const s=Me(c.type);for(const a of["lineA","lineB"]){if(!ge[a])continue;const r=G[a]||{};for(const n of s){const l=r[n];if((l&&Array.isArray(l)?l:[]).reduce((b,p)=>b+Number((p==null?void 0:p.percent)||0),0)!==100)return!1}}}if(e===9){const s=h(c.shiftDuration),a=h(f.lineA.workTime)+h(f.lineA.stopTime),r=h(f.lineB.workTime)+h(f.lineB.stopTime);if(a!==s||r!==s)return!1}return!0},Ae=()=>{if(i)return!0;if(!c.date||!c.shiftDuration)return!1;const e=h(c.shiftDuration),s=h(f.lineA.workTime)+h(f.lineA.stopTime),a=h(f.lineB.workTime)+h(f.lineB.stopTime);return!(s!==e||a!==e)},M=(()=>{if(i)return[];const e=[];c.name||e.push({tabId:1,message:"شیفت انتخاب نشده است."}),c.type||e.push({tabId:1,message:"نوبت کاری انتخاب نشده است."}),c.date||e.push({tabId:1,message:"تاریخ شیفت وارد نشده است."}),(!c.shiftDuration||h(c.shiftDuration)<=0)&&e.push({tabId:1,message:"مدت شیفت معتبر نیست."}),Object.keys(x).length||e.push({tabId:1,message:"حداقل وضعیت حضور یک نفر باید ثبت شود."});const s=h(c.shiftDuration),a=h(f.lineA.workTime)+h(f.lineA.stopTime),r=h(f.lineB.workTime)+h(f.lineB.stopTime);return s>0&&(a!==s||r!==s)&&e.push({tabId:9,message:"جمع کارکرد/توقف هر خط باید با مدت شیفت برابر باشد."}),e})(),ae=M[0],m=Me(c.type),Xe=(e,s,a)=>{if(i)return;const r=Number(a);if(r<0)return;const n=m.indexOf(s);if(n<0){z(l=>({...l,[e]:{...l[e],[s]:r}}));return}z(l=>{const u={...l[e]};for(let b=n;b<m.length;b++){const p=m[b];p&&(u[p]=r)}return{...l,[e]:u}})},_e=e=>{const s=h(e),a=h(c.shiftDuration);return s<=a},qe=()=>{A({name:"A",type:"Day1",date:Le(),shiftDuration:"12:00",supervisor:I.id,supervisorName:I.fullName}),z({lineA:{},lineB:{}}),T({lineA:{},lineB:{}}),fe({lineA:!0,lineB:!0}),L({lineA:{primary:{active:!1,amp08:"",amp02:"",dens08:"",dens02:"",ballSize:"",barrelCount:"",charges:[]},secondary:{active:!1,amp08:"",amp02:"",dens08:"",dens02:"",ballSize:"",barrelCount:"",charges:[]}},lineB:{primary:{active:!1,amp08:"",amp02:"",dens08:"",dens02:"",ballSize:"",barrelCount:"",charges:[]},secondary:{active:!1,amp08:"",amp02:"",dens08:"",dens02:"",ballSize:"",barrelCount:"",charges:[]}}}),Q({lineA:{primary:{active:!1,activeCyclones:[],pressure08:"",angle08:"",pressure02:"",angle02:""},secondary:{active:!1,activeCyclones:[],pressure08:"",angle08:"",pressure02:"",angle02:""}},lineB:{primary:{active:!1,activeCyclones:[],pressure08:"",angle08:"",pressure02:"",angle02:""},secondary:{active:!1,activeCyclones:[],pressure08:"",angle08:"",pressure02:"",angle02:""}}}),Z({lineA:{active:!1,single:!1,upper:!1,middle:!1,lower:!1,description:""},lineB:{active:!1,single:!1,upper:!1,middle:!1,lower:!1,description:""}}),ee({lineA:{active:!1,operator:"",hours:"",cloths:[]},lineB:{active:!1,operator:"",hours:"",cloths:[]},reserve:{active:!1,operator:"",hours:"",cloths:[]}}),B({lineA:[{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}},{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}},{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}}],lineB:[{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}},{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}},{active:!1,hoursWorked:"",channelOutput:"",description:"",data:{}}]}),te({lineA:[{active:!1,operator:"",hours:"",cloths:[]},{active:!1,operator:"",hours:"",cloths:[]}],lineB:[{active:!1,operator:"",hours:"",cloths:[]},{active:!1,operator:"",hours:"",cloths:[]}]}),se({process:[],cleanWater:[]}),S({lineA:{workTime:"",stopTime:"",reason:""},lineB:{workTime:"",stopTime:"",reason:""},generalDescription:[""]}),E({}),V({}),D({nextShiftActions:[""]}),ke(!1),C("FORM"),k(1)},Ge=async()=>{if(ke(!0),M.length>0){k((ae==null?void 0:ae.tabId)||1),alert(`فرم ناقص است:
${M.map(e=>`• ${e.message}`).join(`
`)}`);return}ce(!0);try{const s={code:await Pt("T"),shiftInfo:c,production:W,feedInfo:G,ballMills:J,hydrocyclones:be,drumMagnets:xe,concentrateFilters:ye,thickeners:ve,recoveryFilters:je,pumps:we,downtime:f,footer:Ne,totalA:Object.values(W.lineA).reduce((a,r)=>a+r,0),totalB:Object.values(W.lineB).reduce((a,r)=>a+r,0),attendanceMap:x,leaveTypes:q};await $t(s),alert("گزارش با موفقیت ثبت شد."),Y(!1),pe(s),C("VIEW")}catch(e){alert("خطا در ثبت گزارش: "+e.message)}finally{ce(!1)}},Je=e=>{pe(e.full_data),C("VIEW")},Qe=e=>{const s=e.full_data;s&&(A(s.shiftInfo),z(s.production),T(s.feedInfo||{lineA:{},lineB:{}}),L(s.ballMills),Q(s.hydrocyclones),Z(s.drumMagnets),ee(s.concentrateFilters),B(s.thickeners),te(s.recoveryFilters),se(s.pumps),S(s.downtime),D(s.footer),E(s.attendanceMap||{}),V(s.leaveTypes||{})),C("FORM"),k(1)},Ze=()=>{const e=H.length>0?U.filter(n=>H.includes(n.id)):U;if(e.length===0){alert("داده‌ای برای گزارش وجود ندارد.");return}const s=e.map(n=>({"کد گزارش":n.tracking_code,تاریخ:n.shift_date,شیفت:n.shift_name,"نوع شیفت":Fe[n.shift_type]||n.shift_type,"سرپرست شیفت":n.supervisor_name,"خوراک خط A":n.total_production_a,"خوراک خط B":n.total_production_b})),a=ie.json_to_sheet(s),r=ie.book_new();ie.book_append_sheet(r,a,"ShiftReports"),Kt(r,`shift_reports_${new Date().getTime()}.xlsx`)},et=async e=>{try{const{error:s}=await Be.from("shift_reports").delete().in("id",e);if(s)throw s;me(a=>a.filter(r=>!e.includes(r.id))),de([])}catch(s){console.error("Error deleting shift reports:",s),alert("خطا در حذف گزارش‌ها")}},tt=e=>{const s=zt(e);return s?["یکشنبه","دوشنبه","سه‌شنبه","چهارشنبه","پنج‌شنبه","جمعه","شنبه"][s.getDay()]:""},re=(e,s)=>E(a=>({...a,[e]:s})),ne=e=>E(s=>{const a={...s};return delete a[e],a}),st=(e,s,a,r)=>B(n=>{const l=[...n[e]];return l[s]={...l[s],[a]:r},{...n,[e]:l}}),at=(e,s,a,r,n)=>B(l=>{const u=[...l[e]],b=u[s].data[a]||{};return u[s].data={...u[s].data,[a]:{...b,[r]:n}},{...l,[e]:u}}),Te=(e,s)=>alert("Voice input simulated"),rt=(e,s)=>alert("Voice input simulated"),nt=(e,s,a)=>S(r=>({...r,[e]:{...r[e],[s]:a}})),lt=(e,s,a)=>{e==="downtime"?S(r=>{const n=[...r.generalDescription];return n[s]=a,{...r,generalDescription:n}}):D(r=>{const n=[...r.nextShiftActions];return n[s]=a,{...r,nextShiftActions:n}})},ot=e=>{e==="downtime"?S(s=>({...s,generalDescription:[...s.generalDescription,""]})):D(s=>({...s,nextShiftActions:[...s.nextShiftActions,""]}))},it=(e,s)=>{e==="downtime"?S(a=>({...a,generalDescription:a.generalDescription.filter((r,n)=>n!==s)})):D(a=>({...a,nextShiftActions:a.nextShiftActions.filter((r,n)=>n!==s)}))},P=(e,s)=>{const a=[...e||[{type:"",percent:0}]];for(;a.length<=s;)a.push({type:"",percent:0});return a},ct=(e,s,a,r)=>{if(i)return;const n=m[s];n&&T(l=>{const u={...l[e]},p=P(u[n],a).map((d,N)=>N===a?{...d,type:r,isCustom:!1}:{...d}),y=()=>p.map(d=>({...d}));for(let d=s;d<m.length;d++){const N=m[d];N&&(u[N]=y())}return{...l,[e]:u}})},dt=(e,s,a,r)=>{if(i)return;const n=m[s];n&&T(l=>{const u={...l[e]},p=P(u[n],a).map((d,N)=>N===a?{...d,type:r,isCustom:!0}:{...d}),y=()=>p.map(d=>({...d}));for(let d=s;d<m.length;d++){const N=m[d];N&&(u[N]=y())}return{...l,[e]:u}})},ut=(e,s,a)=>{if(i)return;const r=m[s];r&&T(n=>{const l={...n[e]},b=P(l[r],a).map((y,d)=>d===a?{type:"",percent:0,isCustom:!1}:{...y}),p=()=>b.map(y=>({...y}));for(let y=s;y<m.length;y++){const d=m[y];d&&(l[d]=p())}return{...n,[e]:l}})},ht=(e,s,a,r)=>{if(i)return;const n=m[s];n&&T(l=>{var De;const u={...l[e]},b=P(u[n],a);let p=0;for(let j=0;j<a;j++)p+=Number(((De=b[j])==null?void 0:De.percent)||0);const y=Math.max(0,100-p),d=Math.max(0,Math.min(y,Number(r)||0)),N=b.map((j,$)=>$===a?{...j,percent:d}:{...j}),ft=()=>N.map(j=>({...j}));for(let j=s;j<m.length;j++){const $=m[j];$&&(u[$]=ft())}return{...l,[e]:u}})},mt=(e,s)=>{if(i)return;const a=J[e][s],r=Number(a.ballSize),n=Number(a.barrelCount);!r||!n||L(l=>({...l,[e]:{...l[e],[s]:{...l[e][s],charges:[...l[e][s].charges,{size:r,count:n}],ballSize:"",barrelCount:""}}}))},pt=(e,s,a)=>{i||L(r=>({...r,[e]:{...r[e],[s]:{...r[e][s],charges:r[e][s].charges.filter((n,l)=>l!==a)}}}))},gt=t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"تاریخ"}),t.jsx("input",{type:"text",className:"w-full p-2 border rounded-lg bg-white dark:bg-gray-800 dark:border-gray-600",placeholder:"1403/--/--",value:R,onChange:e=>Ke(e.target.value)})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"نوبت کاری"}),t.jsxs("select",{className:"w-full p-2 border rounded-lg bg-white dark:bg-gray-800 dark:border-gray-600 outline-none",value:O,onChange:e=>He(e.target.value),children:[t.jsx("option",{value:"ALL",children:"همه"}),t.jsx("option",{value:"Day1",children:"روز کار اول"}),t.jsx("option",{value:"Day2",children:"روز کار دوم"}),t.jsx("option",{value:"Night1",children:"شب کار اول"}),t.jsx("option",{value:"Night2",children:"شب کار دوم"})]})]})]});return F==="VIEW"&&X?t.jsx(Ht,{reportData:X,adminAvatar:ze,onBack:()=>C("LIST")}):F==="FORM"?t.jsxs("div",{className:"max-w-7xl mx-auto pb-24",children:[t.jsxs("div",{className:"flex justify-between items-center mb-6 sticky top-0 bg-gray-50 dark:bg-gray-900 z-20 py-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ie,{className:"w-8 h-8 text-primary"}),t.jsx("div",{children:t.jsx("h1",{className:"text-2xl font-bold",children:"ثبت گزارش شیفت جدید"})})]}),t.jsx("button",{onClick:()=>C("LIST"),className:"p-2 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full",children:t.jsx(vt,{className:"w-6 h-6"})})]}),t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm mb-6 sticky top-16 z-10 border border-gray-200 dark:border-gray-700 overflow-x-auto",children:t.jsx("div",{className:"flex min-w-max",children:jt.map(e=>t.jsxs("button",{onClick:()=>k(e.id),className:`flex-1 py-4 px-6 flex items-center justify-center gap-2 text-sm font-bold transition-all border-b-4 
                        ${g===e.id?"border-primary text-primary bg-primary/5":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[t.jsx(e.icon,{className:"w-5 h-5"})," ",e.label]},e.id))})}),t.jsxs("form",{className:"space-y-6",onSubmit:e=>{e.preventDefault(),Y(!0)},children:[g===1&&t.jsxs("div",{className:"space-y-6 animate-fadeIn",children:[t.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 items-end",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold mb-1",children:"شیفت"}),t.jsx("select",{disabled:i,value:c.name,onChange:e=>A({...c,name:e.target.value}),className:"w-full p-2.5 border rounded-xl dark:bg-gray-700 outline-none text-sm disabled:opacity-60",children:["A","B","C"].map(e=>t.jsxs("option",{value:e,children:["شیفت ",e]},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold mb-1",children:"نوبت کاری"}),t.jsxs("select",{disabled:i,value:c.type,onChange:e=>A({...c,type:e.target.value}),className:"w-full p-2.5 border rounded-xl dark:bg-gray-700 outline-none text-sm disabled:opacity-60",children:[t.jsx("option",{value:"Day1",children:"روز کار اول"}),t.jsx("option",{value:"Day2",children:"روز کار دوم"}),t.jsx("option",{value:"Night1",children:"شب کار اول"}),t.jsx("option",{value:"Night2",children:"شب کار دوم"})]})]}),t.jsx("div",{children:t.jsxs("div",{className:"w-full",children:[t.jsx("label",{className:"block text-xs font-black mb-1.5 text-gray-800 dark:text-white",children:"مدت شیفت"}),t.jsx(wt,{value:c.shiftDuration,onChange:e=>!i&&A({...c,shiftDuration:e})})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold mb-1",children:"روز هفته"}),t.jsx("div",{className:"w-full p-2.5 border rounded-xl bg-gray-100 dark:bg-gray-600 text-center text-sm",children:tt(c.date)})]}),t.jsx("div",{children:t.jsxs("div",{className:"w-full",children:[t.jsx("label",{className:"block text-xs font-black mb-1.5 text-gray-800 dark:text-white",children:"تاریخ"}),t.jsx(Nt,{value:c.date,onChange:e=>!i&&A({...c,date:e})})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-bold mb-1",children:"سرپرست شیفت"}),t.jsx("div",{className:"w-full p-2.5 border rounded-xl bg-gray-100 dark:bg-gray-600 truncate text-sm",children:c.supervisorName})]})]})}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm",children:[t.jsx("h3",{className:"font-bold text-lg mb-4 text-gray-700 dark:text-gray-200",children:"وضعیت حضور و غیاب پرسنل"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-t-xl border-b-2 border-green-500 flex items-center justify-center gap-2",children:[t.jsx(kt,{className:"w-5 h-5 text-green-700 dark:text-green-400"}),t.jsx("h4",{className:"font-bold text-green-700 dark:text-green-400 text-center",children:"حاضرین"})]}),t.jsxs("div",{className:"bg-green-50/50 dark:bg-green-900/10 p-3 rounded-b-xl border border-green-200 dark:border-green-800 min-h-[200px]",children:[!i&&t.jsxs("div",{className:"relative mb-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(le,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"",className:"w-full pr-8 pl-2 py-2 text-sm border rounded bg-white dark:bg-gray-800 outline-none focus:ring-1 focus:ring-green-500",value:v.present,onChange:e=>_(s=>({...s,present:e.target.value}))})]}),v.present&&t.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 max-h-40 overflow-y-auto bg-white dark:bg-gray-800 border rounded shadow-lg z-10",children:[w.filter(e=>!x[e.id]&&String(e.full_name||"").toLowerCase().includes(v.present.toLowerCase())).slice(0,10).map(e=>t.jsx("button",{type:"button",className:"w-full text-right px-3 py-2 text-sm hover:bg-green-50 dark:hover:bg-green-900/20",onClick:()=>{re(e.id,"PRESENT"),_(s=>({...s,present:""}))},children:e.full_name},e.id)),w.filter(e=>!x[e.id]&&String(e.full_name||"").toLowerCase().includes(v.present.toLowerCase())).length===0&&t.jsx("div",{className:"px-3 py-2 text-sm text-gray-400",children:"موردی یافت نشد"})]})]}),t.jsx("div",{className:"space-y-2",children:w.filter(e=>x[e.id]==="PRESENT").map(e=>t.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 p-2 rounded shadow-sm border-r-4 border-green-500",children:[t.jsx("span",{className:"text-sm font-medium",children:e.full_name}),!i&&t.jsx("button",{type:"button",onClick:()=>ne(e.id),className:"text-gray-400 hover:text-red-500",children:t.jsx(oe,{className:"w-4 h-4"})})]},e.id))})]})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"p-3 bg-orange-50 dark:bg-orange-900/20 rounded-t-xl border-b-2 border-orange-500 flex items-center justify-center gap-2",children:[t.jsx(St,{className:"w-5 h-5 text-orange-700 dark:text-orange-400"}),t.jsx("h4",{className:"font-bold text-orange-700 dark:text-orange-400 text-center",children:"مرخصی"})]}),t.jsxs("div",{className:"bg-orange-50/50 dark:bg-orange-900/10 p-3 rounded-b-xl border border-orange-200 dark:border-orange-800 min-h-[200px]",children:[!i&&t.jsxs("div",{className:"relative mb-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(le,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"",className:"w-full pr-8 pl-2 py-2 text-sm border rounded bg-white dark:bg-gray-800 outline-none focus:ring-1 focus:ring-orange-500",value:v.leave,onChange:e=>_(s=>({...s,leave:e.target.value}))})]}),v.leave&&t.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 max-h-40 overflow-y-auto bg-white dark:bg-gray-800 border rounded shadow-lg z-10",children:[w.filter(e=>!x[e.id]&&String(e.full_name||"").toLowerCase().includes(v.leave.toLowerCase())).slice(0,10).map(e=>t.jsx("button",{type:"button",className:"w-full text-right px-3 py-2 text-sm hover:bg-orange-50 dark:hover:bg-orange-900/20",onClick:()=>{re(e.id,"LEAVE"),_(s=>({...s,leave:""}))},children:e.full_name},e.id)),w.filter(e=>!x[e.id]&&String(e.full_name||"").toLowerCase().includes(v.leave.toLowerCase())).length===0&&t.jsx("div",{className:"px-3 py-2 text-sm text-gray-400",children:"موردی یافت نشد"})]})]}),t.jsx("div",{className:"space-y-2",children:w.filter(e=>x[e.id]==="LEAVE").map(e=>t.jsxs("div",{className:"bg-white dark:bg-gray-800 p-2 rounded shadow-sm border-r-4 border-orange-500",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("span",{className:"text-sm font-medium",children:e.full_name}),!i&&t.jsx("button",{type:"button",onClick:()=>ne(e.id),className:"text-gray-400 hover:text-red-500",children:t.jsx(oe,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex gap-2 text-xs bg-orange-50 dark:bg-orange-900/10 p-1.5 rounded",children:[t.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[t.jsx("input",{type:"radio",name:`leave-${e.id}`,checked:q[e.id]==="HOURLY",onChange:()=>V(s=>({...s,[e.id]:"HOURLY"}))})," ساعتی"]}),t.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[t.jsx("input",{type:"radio",name:`leave-${e.id}`,checked:q[e.id]==="DAILY",onChange:()=>V(s=>({...s,[e.id]:"DAILY"}))})," روزانه"]})]})]},e.id))})]})]}),t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-t-xl border-b-2 border-red-500 flex items-center justify-center gap-2",children:[t.jsx(Ct,{className:"w-5 h-5 text-red-700 dark:text-red-400"}),t.jsx("h4",{className:"font-bold text-red-700 dark:text-red-400 text-center",children:"غایبین"})]}),t.jsxs("div",{className:"bg-red-50/50 dark:bg-red-900/10 p-3 rounded-b-xl border border-red-200 dark:border-red-800 min-h-[200px]",children:[!i&&t.jsxs("div",{className:"relative mb-3",children:[t.jsxs("div",{className:"relative",children:[t.jsx(le,{className:"absolute right-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),t.jsx("input",{type:"text",placeholder:"",className:"w-full pr-8 pl-2 py-2 text-sm border rounded bg-white dark:bg-gray-800 outline-none focus:ring-1 focus:ring-red-500",value:v.absent,onChange:e=>_(s=>({...s,absent:e.target.value}))})]}),v.absent&&t.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 max-h-40 overflow-y-auto bg-white dark:bg-gray-800 border rounded shadow-lg z-10",children:[w.filter(e=>!x[e.id]&&String(e.full_name||"").toLowerCase().includes(v.absent.toLowerCase())).slice(0,10).map(e=>t.jsx("button",{type:"button",className:"w-full text-right px-3 py-2 text-sm hover:bg-red-50 dark:hover:bg-red-900/20",onClick:()=>{re(e.id,"ABSENT"),_(s=>({...s,absent:""}))},children:e.full_name},e.id)),w.filter(e=>!x[e.id]&&String(e.full_name||"").toLowerCase().includes(v.absent.toLowerCase())).length===0&&t.jsx("div",{className:"px-3 py-2 text-sm text-gray-400",children:"موردی یافت نشد"})]})]}),t.jsx("div",{className:"space-y-2",children:w.filter(e=>x[e.id]==="ABSENT").map(e=>t.jsxs("div",{className:"flex justify-between items-center bg-white dark:bg-gray-800 p-2 rounded shadow-sm border-r-4 border-red-500",children:[t.jsx("span",{className:"text-sm font-medium",children:e.full_name}),!i&&t.jsx("button",{type:"button",onClick:()=>ne(e.id),className:"text-gray-400 hover:text-red-500",children:t.jsx(oe,{className:"w-4 h-4"})})]},e.id))})]})]})]})]})]}),Ye&&M.length>0&&t.jsxs("div",{className:"p-3 rounded-xl border border-amber-300 bg-amber-50 text-amber-900 text-sm",children:[t.jsx("div",{className:"font-bold mb-1",children:"موارد نیازمند اصلاح"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:M.map((e,s)=>t.jsxs("button",{type:"button",onClick:()=>k(e.tabId),className:"px-2 py-1 rounded bg-white border border-amber-300 hover:bg-amber-100",children:["تب ",e.tabId,": ",e.message]},`${e.tabId}-${s}`))})]}),g===2&&t.jsx(At,{production:W,feedInfo:G,isReadOnly:i,handleTonnageChange:Xe,handleFeedTypeChange:ct,handleCustomFeedType:dt,resetFeedType:ut,handleFeedPercentChange:ht,feedLinesActive:ge,setFeedLinesActive:fe,shiftType:c.type}),g===3&&t.jsx(_t,{ballMills:J,setBallMills:L,isReadOnly:i,handleAddBallCharge:mt,handleRemoveBallCharge:pt}),g===4&&t.jsx(Tt,{hydrocyclones:be,setHydrocyclones:Q,isReadOnly:i}),g===5&&t.jsx(Dt,{drumMagnets:xe,setDrumMagnets:Z,isReadOnly:i,handleVoiceInputMultiline:Te}),g===6&&t.jsx(Lt,{concentrateFilters:ye,setConcentrateFilters:ee,isReadOnly:i,validateDurationVsShift:_e,personnel:w,attendanceMap:x}),g===7&&t.jsx(Bt,{thickeners:ve,setThickeners:B,isReadOnly:i,handleThickenerMetaChange:st,handleThickenerDataChange:at}),g===8&&t.jsx(Mt,{recoveryFilters:je,setRecoveryFilters:te,isReadOnly:i,validateDurationVsShift:_e,personnel:w,attendanceMap:x}),g===9&&t.jsx(It,{downtime:f,setDowntime:S,footer:Ne,setFooter:D,pumps:we,setPumps:se,isReadOnly:i,handleDowntimeChange:nt,handleDynamicListChange:lt,addDynamicRecord:ot,removeDynamicRecord:it,handleVoiceInputMultiline:Te,handleVoiceInputDynamic:rt,shiftDuration:c.shiftDuration}),t.jsxs("div",{className:"flex items-center justify-between pt-6 border-t dark:border-gray-700 pb-20",children:[t.jsxs("button",{type:"button",onClick:()=>k(e=>Math.max(1,e-1)),disabled:g===1,className:"px-6 py-3 rounded-xl border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50 transition flex items-center gap-2",children:[t.jsx(Ft,{className:"w-5 h-5"})," مرحله قبل"]}),g===9?!i&&t.jsxs("button",{type:"submit",disabled:K||!Ae(),className:`bg-primary text-white px-8 py-3 rounded-xl shadow-lg hover:bg-red-800 transition flex items-center gap-2 transform active:scale-95 font-bold text-lg ${!Ae()||K?"opacity-50 cursor-not-allowed bg-gray-400":""}`,children:[K?t.jsx(Rt,{className:"w-6 h-6 animate-spin"}):t.jsx(Ot,{className:"w-6 h-6"}),"ثبت نهایی گزارش"]}):t.jsxs("button",{type:"button",onClick:()=>k(e=>Math.min(9,e+1)),disabled:!Ce(g),className:`px-8 py-3 rounded-xl shadow transition flex items-center gap-2 font-bold ${Ce(g)?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:["مرحله بعد ",t.jsx(Ut,{className:"w-5 h-5"})]})]})]}),Oe&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fadeIn",children:t.jsx("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden transform scale-100 transition-all",children:t.jsxs("div",{className:"p-6 text-center",children:[t.jsx("div",{className:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4 animate-bounce",children:t.jsx(Et,{className:"w-10 h-10 text-green-600"})}),t.jsx("h3",{className:"text-2xl font-bold mb-2",children:"ثبت نهایی گزارش"}),t.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-6",children:["آیا از صحت اطلاعات وارد شده اطمینان دارید؟",t.jsx("br",{}),"پس از ثبت، امکان ویرایش توسط شما وجود نخواهد داشت."]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{type:"button",onClick:()=>Y(!1),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 transition font-bold text-gray-700 dark:text-gray-300",children:"بازگشت و اصلاح"}),t.jsx("button",{type:"button",onClick:Ge,className:"flex-1 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 shadow-lg transition font-bold",children:"بله، ثبت شود"})]})]})})})]}):t.jsx(Vt,{title:"گزارشات شیفت",icon:Ie,data:U,isLoading:Ee,columns:[{header:"کد گزارش",accessor:e=>t.jsx("span",{className:"font-mono font-bold",children:e.tracking_code}),sortKey:"tracking_code"},{header:"تاریخ",accessor:e=>e.shift_date,sortKey:"shift_date"},{header:"شیفت",accessor:e=>e.shift_name,sortKey:"shift_name"},{header:"نوع شیفت",accessor:e=>Fe[e.shift_type]||e.shift_type,sortKey:"shift_type"},{header:"سرپرست شیفت",accessor:e=>e.supervisor_name||"---",sortKey:"supervisor_name"},{header:"خوراک خط A",accessor:e=>t.jsx("span",{className:"text-blue-600 font-bold",children:e.total_production_a}),sortKey:"total_production_a"},{header:"خوراک خط B",accessor:e=>t.jsx("span",{className:"text-red-600 font-bold",children:e.total_production_b}),sortKey:"total_production_b"}],selectedIds:H,onSelect:de,filterContent:gt,onAdd:qe,onReload:Se,onDelete:et,onEdit:Qe,onViewDetails:Je,onPrint:e=>Wt(Re,"shiftreport",e),onExport:Ze,exportName:"ShiftReports"})};export{ns as ShiftHandover,ns as default};
