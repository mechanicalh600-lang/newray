import{r as n,j as e,A as j,a2 as f,ay as N,s as w,z as o,aa as y}from"./index-Ba5jVD6p.js";import{R as _}from"./refresh-ccw-7aaP1mjM.js";const v=t=>{const r=`${(t==null?void 0:t.action)||""} ${(t==null?void 0:t.details)||""}`.toLowerCase();return r.includes("error")||r.includes("failed")||r.includes("exception")||r.includes("trace")||r.includes("خطا")||r.includes("ناموفق")||r.includes("عدم موفقیت")},$=()=>{const[t,r]=n.useState([]),[x,h]=n.useState(!1),[m,p]=n.useState(""),[i,u]=n.useState(""),g=async()=>{h(!0),p("");try{const{data:s,error:a}=await w.from("system_logs").select("id, created_at, user_name, action, details, ip_address").order("created_at",{ascending:!1}).limit(1e3);if(a)throw a;const l=(s||[]).filter(v).map(d=>({id:d.id,created_at:d.created_at?new Date(d.created_at).toLocaleString("fa-IR"):"-",user_name:d.user_name||"-",action:d.action||"-",details:d.details||"-",ip_address:d.ip_address||"-"}));r(l)}catch(s){p((s==null?void 0:s.message)||"خطا در دریافت لاگ خطاهای نرم‌افزار"),r([])}finally{h(!1)}};n.useEffect(()=>{g()},[]);const c=n.useMemo(()=>{if(!i.trim())return t;const s=i.toLowerCase();return t.filter(a=>`${a.created_at} ${a.user_name} ${a.action} ${a.details} ${a.ip_address}`.toLowerCase().includes(s))},[t,i]),b=()=>{if(c.length===0)return;const s=o.json_to_sheet(c.map(l=>({زمان:l.created_at,کاربر:l.user_name,"نوع خطا/رویداد":l.action,جزئیات:l.details,IP:l.ip_address}))),a=o.book_new();o.book_append_sheet(a,s,"software_errors"),y(a,`software_errors_${Date.now()}.xlsx`)};return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6 pb-20",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 p-2 rounded-lg shadow-sm",children:e.jsx(j,{className:"w-6 h-6 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"خطاهای نرم‌افزار"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"مشاهده و پایش خطاهای ثبت‌شده در لاگ سیستم"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:g,className:"px-3 py-2 rounded-lg bg-blue-50 text-blue-700 hover:bg-blue-100 text-sm font-bold inline-flex items-center gap-1",children:[e.jsx(_,{className:`w-4 h-4 ${x?"animate-spin":""}`}),"بروزرسانی"]}),e.jsxs("button",{onClick:b,className:"px-3 py-2 rounded-lg bg-green-50 text-green-700 hover:bg-green-100 text-sm font-bold inline-flex items-center gap-1",children:[e.jsx(f,{className:"w-4 h-4"}),"خروجی اکسل"]})]})]}),m&&e.jsx("div",{className:"rounded-xl border border-red-200 bg-red-50 text-red-700 px-4 py-3 text-sm",children:m}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl border shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b bg-gray-50 dark:bg-gray-900 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm font-bold text-gray-700 dark:text-gray-200",children:["تعداد خطاها: ",c.length]}),e.jsxs("div",{className:"relative w-72",children:[e.jsx(N,{className:"w-4 h-4 text-gray-400 absolute right-3 top-2.5"}),e.jsx("input",{value:i,onChange:s=>u(s.target.value),placeholder:"جستجو در خطاها...",className:"w-full pr-9 pl-3 py-2 text-sm border rounded-lg bg-white dark:bg-gray-700 outline-none"})]})]}),e.jsx("div",{className:"overflow-auto max-h-[70vh]",children:e.jsxs("table",{className:"w-full text-sm text-right",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-100 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3",children:"زمان"}),e.jsx("th",{className:"p-3",children:"کاربر"}),e.jsx("th",{className:"p-3",children:"نوع خطا/رویداد"}),e.jsx("th",{className:"p-3",children:"جزئیات"}),e.jsx("th",{className:"p-3",children:"IP"})]})}),e.jsx("tbody",{className:"divide-y",children:c.length>0?c.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700/40",children:[e.jsx("td",{className:"p-3 whitespace-nowrap",children:s.created_at}),e.jsx("td",{className:"p-3 whitespace-nowrap",children:s.user_name}),e.jsx("td",{className:"p-3 whitespace-nowrap",children:s.action}),e.jsx("td",{className:"p-3 min-w-[360px]",children:s.details}),e.jsx("td",{className:"p-3 whitespace-nowrap ltr text-left",children:s.ip_address})]},s.id)):e.jsx("tr",{children:e.jsx("td",{className:"p-10 text-center text-gray-400",colSpan:5,children:x?"در حال دریافت...":"موردی یافت نشد"})})})]})})]})]})};export{$ as SoftwareErrors,$ as default};
