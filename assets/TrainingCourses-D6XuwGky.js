import{r as a,s as c,j as e,X as L,d as F,F as I,a4 as M,bL as O}from"./index-Ba5jVD6p.js";const j={id:"",code:"",title:"",duration_hours:"",provider:""},A=()=>{const[u,f]=a.useState([]),[y,N]=a.useState([]),[w,p]=a.useState(!1),[h,x]=a.useState([]),[d,k]=a.useState(""),[C,i]=a.useState(!1),[t,l]=a.useState(j),[g,b]=a.useState(!1);a.useEffect(()=>{m()},[]),a.useEffect(()=>{let s=u;d&&(s=s.filter(r=>{var o;return(o=r.provider)==null?void 0:o.includes(d)})),N(s)},[u,d]);const m=async()=>{p(!0);const{data:s}=await c.from("training_courses").select("*").order("created_at",{ascending:!1});s&&f(s),p(!1)},S=async s=>{await c.from("training_courses").delete().in("id",s),f(r=>r.filter(o=>!s.includes(o.id))),x([])},_=()=>{l(j),i(!0)},E=()=>{const s=h[0],r=u.find(o=>o.id===s);r&&(l({id:r.id,code:r.code||"",title:r.title||"",duration_hours:r.duration_hours??"",provider:r.provider||""}),i(!0))},D=async s=>{var r,o,v;if(s.preventDefault(),!(!((r=t.title)!=null&&r.trim())||g)){b(!0);try{const n={code:((o=t.code)==null?void 0:o.trim())||null,title:t.title.trim(),duration_hours:t.duration_hours?Number(t.duration_hours):null,provider:((v=t.provider)==null?void 0:v.trim())||null};t.id?(await c.from("training_courses").update(n).eq("id",t.id),alert("دوره با موفقیت ویرایش شد.")):(await c.from("training_courses").insert(n),alert("دوره با موفقیت اضافه شد.")),i(!1),m()}catch(n){alert("خطا: "+((n==null?void 0:n.message)||"خطا در ذخیره"))}finally{b(!1)}}},K=e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 mb-1",children:"برگزار کننده"}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded-lg bg-white dark:bg-gray-800",value:d,onChange:s=>k(s.target.value),placeholder:"نام موسسه..."})]})});return e.jsxs(e.Fragment,{children:[C&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",onClick:()=>i(!1),children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-lg p-6 space-y-4",onClick:s=>s.stopPropagation(),children:e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"flex justify-between items-center border-b dark:border-gray-700 pb-3",children:[e.jsx("h3",{className:"font-bold text-lg",children:t.id?"ویرایش دوره":"تعریف دوره جدید"}),e.jsx("button",{type:"button",onClick:()=>i(!1),children:e.jsx(L,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 font-medium",children:"کد دوره"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-gray-700 outline-none focus:ring-2 focus:ring-primary",value:t.code,onChange:s=>l({...t,code:s.target.value}),placeholder:"اختیاری..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1 font-medium",children:["عنوان دوره / مهارت ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{required:!0,className:"w-full p-2.5 border rounded-lg dark:bg-gray-700 outline-none focus:ring-2 focus:ring-primary",value:t.title,onChange:s=>l({...t,title:s.target.value}),placeholder:"مثال: آموزش ایمنی عمومی"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 font-medium",children:"مدت (ساعت)"}),e.jsx("input",{type:"number",className:"w-full p-2.5 border rounded-lg dark:bg-gray-700 outline-none focus:ring-2 focus:ring-primary text-center",value:t.duration_hours,onChange:s=>l({...t,duration_hours:s.target.value}),placeholder:"مثال: ۸"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1 font-medium",children:"برگزار کننده"}),e.jsx("input",{className:"w-full p-2.5 border rounded-lg dark:bg-gray-700 outline-none focus:ring-2 focus:ring-primary",value:t.provider,onChange:s=>l({...t,provider:s.target.value}),placeholder:"مثال: واحد HSE"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>i(!1),className:"flex-1 border py-2.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition",children:"انصراف"}),e.jsxs("button",{type:"submit",disabled:g,className:"flex-1 bg-primary text-white py-2.5 rounded-lg hover:bg-red-800 flex items-center justify-center gap-2 transition disabled:bg-gray-400 disabled:cursor-not-allowed",children:[g?e.jsx(F,{className:"w-4 h-4 animate-spin"}):e.jsx(I,{className:"w-4 h-4"}),t.id?"ذخیره تغییرات":"افزودن دوره"]})]})]})]})})}),e.jsx(M,{title:"لیست دوره‌های آموزشی",icon:O,data:y,isLoading:w,onAdd:_,onReload:m,onDelete:S,selectedIds:h,onSelect:x,filterContent:K,onEdit:E,onViewDetails:()=>{},exportName:"Courses",columns:[{header:"کد دوره",accessor:s=>e.jsx("span",{className:"font-mono font-bold",children:s.code||"-"}),sortKey:"code"},{header:"عنوان دوره",accessor:s=>s.title,sortKey:"title"},{header:"مدت (ساعت)",accessor:s=>s.duration_hours??"-",sortKey:"duration_hours"},{header:"برگزار کننده",accessor:s=>s.provider||"-",sortKey:"provider"}]})]})};export{A as TrainingCourses,A as default};
